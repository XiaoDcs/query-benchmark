<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Page Scorer - Electron</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 15px;
      background-color: #f5f5f5;
      overflow-x: hidden;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .nav-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap; /* ÂÖÅËÆ∏Êç¢Ë°å‰ª•Èò≤‰∏á‰∏Ä */
    }
    .nav-buttons button {
      white-space: nowrap; /* Èò≤Ê≠¢ÊåâÈíÆÊñáÂ≠óÊç¢Ë°å */
    }
    .score-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .action-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    button {
      padding: 8px 12px;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #3367d6;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .score-button {
      padding: 10px 16px;
      font-weight: bold;
      font-size: 14px;
    }
    .pass {
      background-color: #34a853;
    }
    .pass:hover {
      background-color: #2e8b47;
    }
    .fail {
      background-color: #ea4335;
    }
    .fail:hover {
      background-color: #d33426;
    }
    .screenshot-top {
      background-color: #ff9800;
      padding: 8px 12px;
    }
    .screenshot-top:hover {
      background-color: #f57c00;
    }
    .content {
      display: flex;
      gap: 15px;
      height: calc(100vh - 100px); /* ÂáèÂ∞ëÈ°∂ÈÉ®Á©∫Èó¥Ôºå‰ªé120pxÊîπ‰∏∫100px */
      min-height: 650px;
    }
    .web-view {
      flex: 1;
      min-width: 500px;
      display: flex;
      flex-direction: column;
    }
    .web-frame {
      width: 100%;
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 100%;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sidebar {
      width: 320px;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 100%;
      overflow-y: auto;
    }
    .info-panel, .settings-panel, .issue-panel {
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 4px;
      flex-shrink: 0;
    }
    .progress-overview-panel {
      background-color: #f0f8ff;
      padding: 12px;
      border-radius: 4px;
      border: 1px solid #b3d9ff;
      flex-shrink: 0;
    }
    .progress-overview-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #1976d2;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toggle-progress-btn {
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      padding: 0;
      line-height: 1;
    }
    .toggle-progress-btn:hover {
      background-color: #1565c0;
      transform: scale(1.1);
    }
    .progress-content {
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .progress-content.collapsed {
      max-height: 0;
      opacity: 0;
      padding: 0;
      margin: 0;
    }
    .progress-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding: 8px;
      background-color: #ffffff;
      border-radius: 4px;
      border: 1px solid #e1f5fe;
    }
    .stat-item {
      font-size: 11px;
      font-weight: bold;
      text-align: center;
    }
    .progress-grid-container {
      position: relative;
      background-color: #ffffff;
      border-radius: 4px;
      border: 1px solid #e1f5fe;
      margin-bottom: 10px;
      max-height: 180px;
      overflow: hidden;
    }
    .progress-grid {
      display: grid;
      grid-template-columns: 24px repeat(15, 1fr);
      gap: 1px;
      padding: 8px;
      max-height: 180px;
      overflow-y: auto;
      position: relative;
    }
    .progress-row-number {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: #666;
      font-weight: bold;
      background-color: #f5f5f5;
      border-radius: 2px;
      min-height: 14px;
      grid-column: 1;
    }
    .progress-item {
      width: 14px;
      height: 14px;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      min-width: 14px;
    }
    .progress-item:hover {
      transform: scale(1.3);
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .progress-item.pass {
      background-color: #4caf50;
    }
    .progress-item.fail {
      background-color: #f44336;
    }
    .progress-item.pending {
      background-color: #e0e0e0;
      border: 1px solid #bdbdbd;
    }
    .progress-item.current {
      background-color: #2196f3;
      box-shadow: 0 0 6px rgba(33, 150, 243, 0.6);
    }
    .progress-legend {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .legend-color {
      width: 8px;
      height: 8px;
      border-radius: 2px;
    }
    .legend-color.pass {
      background-color: #4caf50;
    }
    .legend-color.fail {
      background-color: #f44336;
    }
    .legend-color.pending {
      background-color: #e0e0e0;
      border: 1px solid #bdbdbd;
    }
    .legend-color.current {
      background-color: #2196f3;
    }
    .info-panel h3, .settings-panel h3, .issue-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    .info-panel p {
      margin: 8px 0;
      font-size: 13px;
    }
    .status {
      margin-top: 10px;
      padding: 8px;
      background-color: #f2f2f2;
      border-radius: 4px;
      text-align: center;
      font-size: 12px;
      flex-shrink: 0;
    }
    .screenshot-preview {
      max-width: 100%;
      max-height: 120px;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      font-size: 16px;
      color: #666;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }
    .url-display {
      word-break: break-all;
      color: #1a73e8;
      text-decoration: none;
      font-size: 12px;
    }
    .url-display:hover {
      text-decoration: underline;
    }
    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: #e0e0e0;
      border-radius: 2px;
      margin: 8px 0;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background-color: #4285f4;
      transition: width 0.3s ease;
    }
    .web-container {
      position: relative;
      flex: 1;
    }
    
    /* Á¥ßÂáëÁöÑÁº©Áï•ÂõæÂÆπÂô® */
    #thumbnail-container {
      margin: 10px 0;
    }
    #thumbnail-container strong {
      font-size: 13px;
    }
    #thumbnail-preview, #thumbnail-placeholder {
      max-height: 80px;
      max-width: 100%;
      margin-top: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: block;
      cursor: pointer;
    }
    #thumbnail-placeholder {
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
      color: #666;
      font-size: 12px;
    }
    
    /* Ëá™Âä®Ë∑≥ËΩ¨ÂºÄÂÖ≥Ê†∑Âºè */
    .settings-panel {
      background-color: #f0f8ff;
      padding: 12px;
      border-radius: 4px;
      border: 1px solid #b3d9ff;
      flex-shrink: 0;
    }
    .settings-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #1976d2;
    }
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
    }
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
      background-color: #ccc;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .toggle-switch.active {
      background-color: #4285f4;
    }
    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .toggle-switch.active .toggle-slider {
      transform: translateX(26px);
    }
    .toggle-label {
      font-size: 13px;
      color: #333;
    }
    .preload-status {
      font-size: 11px;
      color: #666;
      margin-top: 8px;
      padding: 6px;
      background-color: #f8f9fa;
      border-radius: 3px;
    }
    .shortcuts-info {
      font-size: 11px;
      color: #666;
      margin-top: 8px;
      line-height: 1.4;
    }

    /* IssueÊ†áÁ≠æÁõ∏ÂÖ≥Ê†∑Âºè */
    .issue-panel {
      background-color: #fff3e0;
      border: 1px solid #ffcc80;
    }
    .issue-panel h3 {
      color: #f57c00;
    }
    .preset-tags {
      margin-bottom: 10px;
    }
    .preset-tag {
      display: inline-block;
      background-color: #e3f2fd;
      color: #1976d2;
      padding: 4px 8px;
      margin: 2px 4px 2px 0;
      border-radius: 12px;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid #bbdefb;
      transition: all 0.2s;
    }
    .preset-tag:hover {
      background-color: #bbdefb;
    }
    .preset-tag.active {
      background-color: #2196f3;
      color: white;
    }
    .preset-tag.custom-tag {
      background-color: #f3e5f5;
      color: #7b1fa2;
      border-color: #ce93d8;
    }
    .preset-tag.custom-tag:hover {
      background-color: #ce93d8;
    }
    .add-tag-btn {
      display: inline-block;
      background-color: #e8f5e8;
      color: #2e7d32;
      padding: 4px 8px;
      margin: 2px 4px 2px 0;
      border-radius: 12px;
      font-size: 11px;
      cursor: pointer;
      border: 1px dashed #4caf50;
      transition: all 0.2s;
    }
    .add-tag-btn:hover {
      background-color: #c8e6c9;
    }
    .add-tag-input {
      margin: 8px 0;
      padding: 8px;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .add-tag-input input {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 8px;
    }
    .add-tag-input button {
      padding: 4px 12px;
      margin-right: 4px;
      font-size: 11px;
    }
    .edit-tag-input {
      margin: 8px 0;
      padding: 8px;
      background-color: #fff3e0;
      border: 1px solid #ffcc80;
      border-radius: 4px;
    }
    .edit-tag-input input {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 8px;
    }
    .edit-tag-input button {
      padding: 4px 12px;
      margin-right: 4px;
      font-size: 11px;
    }
    .tag-shortcuts {
      font-size: 10px;
      color: #666;
      margin-top: 5px;
      line-height: 1.3;
    }
    
    /* ÁßªÂä®Á´ØÂìçÂ∫îÂºè */
    @media (max-width: 900px) {
      .content {
        flex-direction: column;
        height: auto;
        min-height: auto;
      }
      .sidebar {
        width: 100%;
        min-width: auto;
        max-height: none;
      }
      .web-view {
        min-width: auto;
        height: 50vh;
        min-height: 400px;
      }
      .controls {
        flex-direction: column;
        gap: 8px;
      }
      .nav-buttons, .score-buttons, .action-buttons {
        justify-content: center;
        flex-wrap: wrap;
      }
    }

    /* Ëá™ÂÆö‰πâÂø´Êç∑ÈîÆÈÖçÁΩÆÊ†∑Âºè */
    .shortcuts-config {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 12px;
      margin-top: 10px;
    }
    .shortcuts-config h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #495057;
    }
    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #e9ecef;
      font-size: 11px;
    }
    .shortcut-item:last-child {
      border-bottom: none;
    }
    .shortcut-label {
      color: #495057;
      flex: 1;
    }
    .shortcut-key {
      background-color: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 3px;
      padding: 2px 6px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      min-width: 60px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .shortcut-key:hover {
      background-color: #dee2e6;
    }
    .shortcut-key.recording {
      background-color: #fff3cd;
      border-color: #ffeaa7;
      color: #856404;
    }
    .shortcut-key.conflict {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
    .shortcuts-actions {
      margin-top: 10px;
      display: flex;
      gap: 5px;
    }
    .shortcuts-actions button {
      font-size: 10px;
      padding: 3px 8px;
    }
    .shortcut-help {
      font-size: 9px;
      color: #6c757d;
      margin-top: 5px;
      line-height: 1.3;
    }

    /* ÂÆπÂô®Áä∂ÊÄÅËÉåÊôØËâ≤ */
    .container.status-unscored {
      background-color: white;
    }
    .container.status-pass {
      background-color: #e8f5e8;
    }
    .container.status-fail {
      background-color: #fde7e7;
    }

    /* ÂÖ®Â±èÂõæÁâáÊü•ÁúãÂô® */
    .fullscreen-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999999;
      cursor: pointer;
    }
    
    .fullscreen-image {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 4px;
    }
    
    /* Response panel styles */
    .response-panel {
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 4px;
      flex-shrink: 0;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .response-panel h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .toggle-response-btn {
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      padding: 0;
      line-height: 1;
    }
    
    .toggle-response-btn:hover {
      background-color: #3367d6;
      transform: scale(1.1);
    }
    
    .response-content {
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .response-content.collapsed {
      max-height: 0;
      opacity: 0;
      padding: 0;
      margin: 0;
    }
    
    .response-tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 10px;
      gap: 5px;
    }
    
    .response-tab {
      padding: 6px 12px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      font-size: 12px;
      background-color: #f0f0f0;
      color: #666;
      transition: all 0.2s;
    }
    
    .response-tab.active {
      background-color: #fff;
      border-color: #ddd;
      font-weight: bold;
      color: #333;
    }
    
    .response-tab:hover {
      background-color: #e8e8e8;
    }
    
    .response-tab-content {
      display: none;
      font-size: 12px;
      line-height: 1.4;
    }
    
    .response-tab-content.active {
      display: block;
    }
    
    .response-content-section {
      background-color: #fff;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #eee;
      margin-bottom: 8px;
      white-space: pre-wrap;
      font-family: inherit;
      font-size: 12px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .response-urls {
      background-color: #fff;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #eee;
      margin-bottom: 8px;
    }
    
    .response-urls ul {
      margin: 0;
      padding-left: 15px;
      font-size: 11px;
    }
    
    .response-urls li {
      margin-bottom: 4px;
    }
    
    .response-urls a {
      color: #4285f4;
      text-decoration: none;
      word-break: break-all;
    }
    
    .response-urls a:hover {
      text-decoration: underline;
    }
    
    .response-images {
      background-color: #fff;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #eee;
      margin-bottom: 8px;
    }
    
    .response-image-gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .response-image-gallery img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border: 1px solid #ddd;
      border-radius: 3px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .response-image-gallery img:hover {
      transform: scale(1.1);
    }
    
    .response-related-questions {
      background-color: #fff;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #eee;
      margin-bottom: 8px;
    }
    
    .response-related-questions ul {
      margin: 0;
      padding-left: 15px;
      font-size: 11px;
    }
    
    .response-related-questions li {
      margin-bottom: 4px;
    }
    
    .response-error {
      background-color: #ffebee;
      color: #c62828;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ffcdd2;
      font-size: 12px;
    }
    
    .response-no-data {
      background-color: #f5f5f5;
      color: #666;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      font-size: 12px;
      text-align: center;
      font-style: italic;
    }
    .mode-selector {
      display: flex;
      background-color: #f5f5f5;
      border-radius: 6px;
      padding: 2px;
      gap: 2px;
    }
    .mode-btn {
      background-color: transparent;
      color: #666;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      font-weight: 500;
    }
    .mode-btn:hover {
      background-color: #e0e0e0;
      color: #333;
    }
    .mode-btn.active {
      background-color: #4285f4;
      color: white;
    }
    .mode-btn.active:hover {
      background-color: #3367d6;
    }
    .response-view-mode {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      background-color: #fafafa;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow-y: auto;
    }
    .web-view.webonly {
      flex: 1;
      width: 100%;
    }
    .response-view-mode.webonly-hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <div class="nav-buttons">
        <button id="file-btn">Select Excel</button>
        <button id="download-sample-btn">Download Sample</button>
        <div class="mode-selector" id="mode-selector">
          <button id="web-mode-btn" class="mode-btn active">üåê Web</button>
          <button id="response-mode-btn" class="mode-btn">üìÑ Response</button>
          <button id="webonly-mode-btn" class="mode-btn">Web Only</button>
        </div>
        <button id="prev-btn" disabled>‚Üê Prev</button>
        <button id="next-btn" disabled>Next ‚Üí</button>
        <button id="reload-btn" disabled>Reload</button>
        <button id="refresh-btn" disabled>Refresh</button>
      </div>
      <div class="score-buttons">
        <button id="pass-btn" class="score-button pass" disabled>‚úÖ Pass</button>
        <button id="fail-btn" class="score-button fail" disabled>‚ùå Fail</button>
        <button id="screenshot-btn" class="screenshot-top" disabled>üì∏ Screenshot</button>
      </div>
      <div class="action-buttons">
        <button id="save-btn" disabled>üíæ Save</button>
        <button id="open-external-btn" disabled>üîó External</button>
      </div>
    </div>
    
    <div class="content">
      <div class="web-view" id="web-view">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        <div class="web-container">
          <div id="web-frame" class="web-frame">
            <div style="text-align: center; color: #666; padding: 20px;">
              <div style="font-size: 48px; margin-bottom: 20px;">üìÑ</div>
              <div style="font-size: 18px; margin-bottom: 10px;">Please select an Excel file to start</div>
              <div style="font-size: 14px; color: #999;">Click "Select Excel File" button above</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="response-view-mode hidden" id="response-view-mode">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill-response" style="width: 0%"></div>
        </div>
        <div class="response-full-content">
          <div id="response-main-display">
            <div style="text-align: center; color: #666; padding: 40px;">
              <div style="font-size: 48px; margin-bottom: 20px;">üìÑ</div>
              <div style="font-size: 18px; margin-bottom: 10px;">Select Response View mode to see parsed content</div>
              <div style="font-size: 14px; color: #999;">Response data will be displayed here</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="sidebar" id="sidebar">
        <div class="info-panel">
          <h3>üìã Page Information</h3>
          <p><strong>Progress:</strong> <span id="page-counter">-</span></p>
          <p><strong>Query:</strong> <span id="current-query">-</span></p>
          <p><strong>URL:</strong> <a href="#" id="current-url" class="url-display" target="_blank">-</a></p>
          <p><strong>Current Score:</strong> <span id="current-score">Not scored</span></p>
          
          <div id="thumbnail-container">
            <strong>Thumbnail:</strong>
            <img id="thumbnail-preview" class="hidden" alt="Thumbnail" />
            <div id="thumbnail-placeholder">No thumbnail available</div>
          </div>
        </div>
        
        <div class="progress-overview-panel" id="progress-overview-panel">
          <h3>üìä Progress Overview 
            <button id="toggle-progress-overview" class="toggle-progress-btn" title="Toggle Progress Overview">‚àí</button>
          </h3>
          <div class="progress-content" id="progress-content">
            <div class="progress-stats">
              <span class="stat-item">‚úÖ <span id="pass-count">0</span></span>
              <span class="stat-item">‚ùå <span id="fail-count">0</span></span>
              <span class="stat-item">‚è∏Ô∏è <span id="pending-count">0</span></span>
              <span class="stat-item">üìã <span id="total-count">0</span></span>
            </div>
            <div class="progress-grid-container">
              <div class="progress-grid" id="progress-grid">
                <!-- ËøõÂ∫¶ÊñπÂùóÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
              </div>
            </div>
            <div class="progress-legend">
              <span class="legend-item"><span class="legend-color pass"></span>Pass</span>
              <span class="legend-item"><span class="legend-color fail"></span>Fail</span>
              <span class="legend-item"><span class="legend-color pending"></span>Pending</span>
              <span class="legend-item"><span class="legend-color current"></span>Current</span>
            </div>
          </div>
        </div>
        
        <div class="issue-panel">
          <h3>üìù Issue Notes</h3>
          
          <!-- È¢ÑËÆæÊ†áÁ≠æÂå∫Âüü -->
          <div class="preset-tags" id="preset-tags-container">
            <!-- Ê†áÁ≠æÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
            <span class="add-tag-btn" id="add-tag-btn" title="Add custom tag">+ Add Tag</span>
          </div>
          
          <div class="tag-shortcuts">
            <strong>Quick tags:</strong> Ctrl+1~9 for tags, Ctrl+0 to clear<br>
            <strong>Edit tags:</strong> Double-click to edit, right-click custom tags to delete
          </div>
          
          <!-- Ê∑ªÂä†Ëá™ÂÆö‰πâÊ†áÁ≠æÁöÑËæìÂÖ•Ê°Ü -->
          <div class="add-tag-input hidden" id="add-tag-input">
            <input type="text" id="new-tag-input" placeholder="Enter new tag name..." maxlength="20">
            <button id="save-tag-btn">Save</button>
            <button id="cancel-tag-btn">Cancel</button>
          </div>
          
          <!-- ÁºñËæëÊ†áÁ≠æÁöÑËæìÂÖ•Ê°Ü -->
          <div class="edit-tag-input hidden" id="edit-tag-input">
            <input type="text" id="edit-tag-text" placeholder="Edit tag name..." maxlength="20">
            <button id="save-edit-btn">Save</button>
            <button id="cancel-edit-btn">Cancel</button>
          </div>
          
          <textarea id="issue-input" rows="3" style="width: 100%; border: 1px solid #ddd; border-radius: 4px; padding: 8px; resize: vertical; margin-top: 8px; font-size: 13px; box-sizing: border-box;" placeholder="Enter issue or note..."></textarea>
          
          <div style="margin-top: 10px;">
            <img id="screenshot-preview" class="screenshot-preview hidden" alt="Screenshot" />
            <div id="no-screenshot" style="text-align: center; padding: 20px; background-color: #f5f5f5; border: 1px dashed #ccc; border-radius: 4px; color: #666; font-size: 12px;">
              üì∑ No screenshot taken
            </div>
          </div>
        </div>
        
        <div class="response-panel" id="response-panel">
          <h3>üîç Response Content 
            <button id="toggle-response" class="toggle-response-btn" title="Toggle Response Content">‚àí</button>
          </h3>
          <div class="response-content" id="response-content">
            <div class="response-tabs">
              <div class="response-tab active" data-tab="content">Content</div>
              <div class="response-tab" data-tab="urls">URLs</div>
              <div class="response-tab" data-tab="images">Images</div>
              <div class="response-tab" data-tab="questions">Related</div>
            </div>
            
            <div class="response-tab-content active" id="response-content-tab">
              <div class="response-no-data">No response data available</div>
            </div>
            
            <div class="response-tab-content" id="response-urls-tab">
              <div class="response-no-data">No URLs available</div>
            </div>
            
            <div class="response-tab-content" id="response-images-tab">
              <div class="response-no-data">No images available</div>
            </div>
            
            <div class="response-tab-content" id="response-questions-tab">
              <div class="response-no-data">No related questions available</div>
            </div>
          </div>
        </div>
        
        <div class="settings-panel">
          <h3>‚öôÔ∏è Settings</h3>
          
          <!-- Auto-advance setting -->
          <div class="toggle-container">
            <div class="toggle-switch" id="auto-next-toggle">
              <div class="toggle-slider"></div>
            </div>
            <label class="toggle-label">Auto-advance on Pass</label>
          </div>
          
          <!-- Auto-fail on issue setting -->
          <div class="toggle-container">
            <div class="toggle-switch" id="auto-fail-toggle">
              <div class="toggle-slider"></div>
            </div>
            <label class="toggle-label">Auto-fail when Issue added</label>
          </div>
          
          <!-- Auto-advance after fail setting -->
          <div class="toggle-container">
            <div class="toggle-switch" id="auto-next-fail-toggle">
              <div class="toggle-slider"></div>
            </div>
            <label class="toggle-label">Auto-advance after Fail</label>
          </div>
          
          <!-- Preload count setting -->
          <div style="margin: 10px 0;">
            <label for="preload-count" style="display: block; margin-bottom: 5px; font-size: 13px; color: #333;">Preload pages:</label>
            <select id="preload-count" style="width: 100%; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
              <option value="0">Disabled</option>
              <option value="3">3 pages</option>
              <option value="5" selected>5 pages</option>
              <option value="10">10 pages</option>
              <option value="15">15 pages</option>
            </select>
          </div>
          
          <!-- Page jump -->
          <div style="margin: 10px 0;">
            <label for="page-jump" style="display: block; margin-bottom: 5px; font-size: 13px; color: #333;">Jump to page:</label>
            <div style="display: flex; gap: 5px;">
              <input type="number" id="page-jump" min="1" max="1" value="1" style="flex: 1; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;" placeholder="Page #">
              <button id="jump-btn" style="padding: 4px 12px; font-size: 12px;">Go</button>
            </div>
          </div>
          
          <div class="preload-status" id="preload-status">
            Preloading: Ready
          </div>
          
          <div class="shortcuts-info">
            <strong>Shortcuts:</strong><br>
            ‚Üë Pass (saves as 1)<br>
            ‚Üì Fail (saves as 0)<br>
            Ctrl+S Save manually
          </div>
          
          <!-- Ëá™ÂÆö‰πâÂø´Êç∑ÈîÆÈÖçÁΩÆ -->
          <div style="margin-top: 10px;">
            <button id="toggle-shortcuts-btn" style="background-color: #6c757d; width: 100%;">‚å®Ô∏è Custom Shortcuts</button>
          </div>
          
          <div class="shortcuts-config" id="shortcuts-config-panel">
            <h4>‚å®Ô∏è Custom Shortcuts</h4>
            <div id="shortcuts-list">
              <!-- Âø´Êç∑ÈîÆÂàóË°®Â∞ÜÁî±JavaScriptÁîüÊàê -->
            </div>
            <div class="shortcuts-actions">
              <button id="reset-shortcuts-btn">Reset All</button>
            </div>
            <div class="shortcut-help">
              Click any shortcut to edit. Press ESC to cancel recording.
            </div>
          </div>
        </div>
        
        <div class="status" id="status">Ready to start</div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer, shell } = require('electron');
    
    // ÁõëÂê¨Êù•Ëá™‰∏ªËøõÁ®ãÁöÑÂÖ®Â±ÄÂø´Êç∑ÈîÆ‰∫ã‰ª∂
    ipcRenderer.on('global-shortcut', (event, action, param) => {
      handleGlobalShortcut(action, param);
    });
    
    // Â§ÑÁêÜÂÖ®Â±ÄÂø´Êç∑ÈîÆ
    function handleGlobalShortcut(action, param) {
      switch (action) {
        case 'pass':
          if (!passBtn.disabled) passBtn.click();
          break;
        case 'fail':
          if (!failBtn.disabled) failBtn.click();
          break;
        case 'save':
          saveBtn.click();
          break;
        case 'reload':
          if (!reloadBtn.disabled) reloadBtn.click();
          break;
        case 'previous':
          if (!prevBtn.disabled) prevBtn.click();
          break;
        case 'next':
          if (!nextBtn.disabled) nextBtn.click();
          break;
        case 'tag':
          // paramÊòØÊ†áÁ≠æÂ∫èÂè∑ (1-9)
          if (param && param >= 1 && param <= 9) {
            const targetTag = document.querySelector(`[data-shortcut="${param}"]`);
            if (targetTag) {
              appendIssueTag(targetTag.dataset.tag);
              // ËßÜËßâÂèçÈ¶à
              targetTag.classList.add('active');
              setTimeout(() => targetTag.classList.remove('active'), 200);
            }
          }
          break;
        case 'clear-tags':
          clearIssueInput();
          break;
        default:
          console.log('Unknown global shortcut:', action);
      }
    }
    
    // DOM elements
    const fileBtn = document.getElementById('file-btn');
    const downloadSampleBtn = document.getElementById('download-sample-btn');
    const webModeBtn = document.getElementById('web-mode-btn');
    const responseModeBtn = document.getElementById('response-mode-btn');
    const webonlyModeBtn = document.getElementById('webonly-mode-btn');
    const webView = document.getElementById('web-view');
    const responseViewMode = document.getElementById('response-view-mode');
    const responseMainDisplay = document.getElementById('response-main-display');
    const progressFillResponse = document.getElementById('progress-fill-response');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const passBtn = document.getElementById('pass-btn');
    const failBtn = document.getElementById('fail-btn');
    const screenshotBtn = document.getElementById('screenshot-btn');
    const saveBtn = document.getElementById('save-btn');
    const reloadBtn = document.getElementById('reload-btn');
    const refreshBtn = document.getElementById('refresh-btn');
    const openExternalBtn = document.getElementById('open-external-btn');
    const webFrame = document.getElementById('web-frame');
    const pageCounterEl = document.getElementById('page-counter');
    const currentQueryEl = document.getElementById('current-query');
    const currentUrlEl = document.getElementById('current-url');
    const currentScoreEl = document.getElementById('current-score');
    const issueInput = document.getElementById('issue-input');
    const screenshotPreview = document.getElementById('screenshot-preview');
    const noScreenshotDiv = document.getElementById('no-screenshot');
    const statusEl = document.getElementById('status');
    const progressFill = document.getElementById('progress-fill');
    const thumbnailPreview = document.getElementById('thumbnail-preview');
    const thumbnailPlaceholder = document.getElementById('thumbnail-placeholder');
    const autoNextToggle = document.getElementById('auto-next-toggle');
    const autoFailToggle = document.getElementById('auto-fail-toggle');
    const autoNextFailToggle = document.getElementById('auto-next-fail-toggle');
    const preloadStatusEl = document.getElementById('preload-status');
    const preloadCountSelect = document.getElementById('preload-count');
    const pageJumpInput = document.getElementById('page-jump');
    const jumpBtn = document.getElementById('jump-btn');
    const addTagBtn = document.getElementById('add-tag-btn');
    const addTagInput = document.getElementById('add-tag-input');
    const newTagInput = document.getElementById('new-tag-input');
    const saveTagBtn = document.getElementById('save-tag-btn');
    const cancelTagBtn = document.getElementById('cancel-tag-btn');
    const editTagInput = document.getElementById('edit-tag-input');
    const editTagText = document.getElementById('edit-tag-text');
    const saveEditBtn = document.getElementById('save-edit-btn');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');
    const presetTagsContainer = document.getElementById('preset-tags-container');
    const shortcutsList = document.getElementById('shortcuts-list');
    const resetShortcutsBtn = document.getElementById('reset-shortcuts-btn');
    const toggleShortcutsBtn = document.getElementById('toggle-shortcuts-btn');
    const shortcutsConfig = document.querySelector('.shortcuts-config');
    
    // Progress Overview elements
    const progressGrid = document.getElementById('progress-grid');
    const passCountEl = document.getElementById('pass-count');
    const failCountEl = document.getElementById('fail-count');
    const pendingCountEl = document.getElementById('pending-count');
    const totalCountEl = document.getElementById('total-count');
    const toggleProgressOverviewBtn = document.getElementById('toggle-progress-overview');
    const progressContent = document.getElementById('progress-content');
    
    // Response panel elements
    const toggleResponseBtn = document.getElementById('toggle-response');
    const responseContent = document.getElementById('response-content');
    const responseTabs = document.querySelectorAll('.response-tab');
    const responseTabContents = document.querySelectorAll('.response-tab-content');
    const responseContentTab = document.getElementById('response-content-tab');
    const responseUrlsTab = document.getElementById('response-urls-tab');
    const responseImagesTab = document.getElementById('response-images-tab');
    const responseQuestionsTab = document.getElementById('response-questions-tab');
    const sidebar = document.getElementById('sidebar');
    
    // Progress Overview state
    let progressOverviewVisible = true;
    
    // App state
    let excelData = [];
    let currentIndex = 1; // ‰ªé1ÂºÄÂßãÔºåË∑≥ËøáÊ†áÈ¢òË°å
    let columns = {};
    let autoNextEnabled = true; // ÈªòËÆ§ÂºÄÂêØËá™Âä®Ë∑≥ËΩ¨
    let autoFailEnabled = false; // ÈªòËÆ§ÂÖ≥Èó≠Ëá™Âä®fail
    let autoNextFailEnabled = false; // ÈªòËÆ§ÂÖ≥Èó≠failÂêéËá™Âä®Ë∑≥ËΩ¨
    let maxPreloadPages = 5; // ÈªòËÆ§È¢ÑÂä†ËΩΩ5È°µ
    let customTags = []; // Ëá™ÂÆö‰πâÊ†áÁ≠æÊï∞ÁªÑ
    let presetTags = []; // È¢ÑËÆæÊ†áÁ≠æÊï∞ÁªÑÔºàÁé∞Âú®‰πüÂèØ‰ª•ÁºñËæëÔºâ
    let currentEditingTag = null; // ÂΩìÂâçÊ≠£Âú®ÁºñËæëÁöÑÊ†áÁ≠æ
    let customShortcuts = {}; // Ëá™ÂÆö‰πâÂø´Êç∑ÈîÆÈÖçÁΩÆ
    let recordingShortcut = null; // ÂΩìÂâçÊ≠£Âú®ÂΩïÂà∂ÁöÑÂø´Êç∑ÈîÆ
    let shortcutsVisible = false; // Âø´Êç∑ÈîÆÈÖçÁΩÆÈù¢ÊùøÂèØËßÅÊÄß
    let thumbnailCache = new Map(); // Áº©Áï•ÂõæÁºìÂ≠ò
    let responseVisible = true; // ResponseÈù¢ÊùøÂèØËßÅÊÄß
    let currentResponseTab = 'content'; // ÂΩìÂâçÊøÄÊ¥ªÁöÑresponseÊ†áÁ≠æÈ°µ
    let displayMode = 'web'; // ÊòæÁ§∫Ê®°ÂºèÔºö'web'„ÄÅ'response' Êàñ 'webonly'
    
    // ÈªòËÆ§È¢ÑËÆæÊ†áÁ≠æ
    const defaultPresetTags = [
      'Êúâ‰∫âËÆÆÊÄß',
      'Ê∂âÂèäÊïèÊÑüËØùÈ¢ò', 
      'Ëøá‰∫é‰∏ªËßÇËØÑ‰ª∑',
      'Ë¥üÈù¢ËØ≠Ë®Ä',
      'Ëøá‰∫éÊ†áÈ¢òÂÖö',
      'ÊåëÊàòÊîøÁ≠ñ/Âà∂Â∫¶',
      'ÂõæÁâáÊó†Ê≥ïÂä†ËΩΩ'
    ];
    
    // ÈªòËÆ§Âø´Êç∑ÈîÆÈÖçÁΩÆ
    const defaultShortcuts = {
      'previous': { keys: ['ArrowLeft'], description: 'Previous Page' },
      'next': { keys: ['ArrowRight'], description: 'Next Page' },
      'pass': { keys: ['ArrowUp'], description: 'Mark as Pass' },
      'fail': { keys: ['ArrowDown'], description: 'Mark as Fail' },
      'save': { keys: ['Control', 's'], description: 'Save Manually' },
      'screenshot': { keys: ['Control', 'p'], description: 'Take Screenshot' },
      'reload': { keys: ['F5'], description: 'Reload Page' },
      'refresh': { keys: ['Control', 'F5'], description: 'Refresh Current Page' },
      'openExternal': { keys: ['Control', 'o'], description: 'Open in Browser' },
      'clearTags': { keys: ['Control', '0'], description: 'Clear Issue Tags' },
      'toggleAutoNext': { keys: ['Control', 'a'], description: 'Toggle Auto-advance' },
      'focusJump': { keys: ['Control', 'g'], description: 'Focus Page Jump' }
    };
    
    // ÂàùÂßãÂåñËá™ÂÆö‰πâÂø´Êç∑ÈîÆÁ≥ªÁªü
    function initCustomShortcuts() {
      console.log('Initializing custom shortcuts...');
      
      // Ê£ÄÊü•ÂøÖË¶ÅÁöÑDOMÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
      if (!shortcutsList) {
        console.error('shortcutsList not found!');
        return;
      }
      
      console.log('Shortcuts DOM elements found, proceeding with initialization...');
      
      // È¶ñÂÖàËÆæÁΩÆÈªòËÆ§Âø´Êç∑ÈîÆ
      customShortcuts = { ...defaultShortcuts };
      console.log('Default shortcuts set:', customShortcuts);
      
      // ‰ªélocalStorageÂä†ËΩΩËá™ÂÆö‰πâÂø´Êç∑ÈîÆ
      const savedShortcuts = localStorage.getItem('customShortcuts');
      console.log('Saved shortcuts:', savedShortcuts);
      
      if (savedShortcuts) {
        try {
          const loadedShortcuts = JSON.parse(savedShortcuts);
          // ÂêàÂπ∂‰øùÂ≠òÁöÑÂø´Êç∑ÈîÆÂíåÈªòËÆ§Âø´Êç∑ÈîÆ
          Object.assign(customShortcuts, loadedShortcuts);
          console.log('Loaded custom shortcuts from storage:', customShortcuts);
        } catch (e) {
          console.error('Failed to load custom shortcuts:', e);
        }
      }
      
      // Ê∏≤ÊüìÂø´Êç∑ÈîÆÂàóË°®
      console.log('About to render shortcuts list...');
      renderShortcutsList();
      console.log('Custom shortcuts initialization completed');
    }
    
    // Ê∏≤ÊüìÂø´Êç∑ÈîÆÂàóË°®
    function renderShortcutsList() {
      console.log('Rendering shortcuts list...');
      
      if (!shortcutsList) {
        console.error('shortcutsList is null, cannot render shortcuts');
        return;
      }
      
      console.log('shortcutsList found, proceeding with shortcuts rendering...');
      console.log('customShortcuts:', customShortcuts);
      
      shortcutsList.innerHTML = '';
      
      Object.entries(customShortcuts).forEach(([action, config]) => {
        console.log(`Rendering shortcut for action: ${action}`, config);
        const item = document.createElement('div');
        item.className = 'shortcut-item';
        
        const label = document.createElement('div');
        label.className = 'shortcut-label';
        label.textContent = config.description;
        
        const keyDisplay = document.createElement('div');
        keyDisplay.className = 'shortcut-key';
        keyDisplay.textContent = formatShortcutDisplay(config.keys);
        keyDisplay.dataset.action = action;
        keyDisplay.title = 'Click to edit';
        
        keyDisplay.addEventListener('click', () => startRecordingShortcut(action, keyDisplay));
        
        item.appendChild(label);
        item.appendChild(keyDisplay);
        shortcutsList.appendChild(item);
        console.log(`Added shortcut item for ${action}`);
      });
      
      console.log('Shortcuts list rendering completed');
    }
    
    // Ê†ºÂºèÂåñÂø´Êç∑ÈîÆÊòæÁ§∫
    function formatShortcutDisplay(keys) {
      if (!keys || keys.length === 0) return 'None';
      
      return keys.map(key => {
        switch(key) {
          case 'Control': return 'Ctrl';
          case 'ArrowLeft': return '‚Üê';
          case 'ArrowRight': return '‚Üí';
          case 'ArrowUp': return '‚Üë';
          case 'ArrowDown': return '‚Üì';
          case ' ': return 'Space';
          default: return key;
        }
      }).join('+');
    }
    
    // ÂºÄÂßãÂΩïÂà∂Âø´Êç∑ÈîÆ
    function startRecordingShortcut(action, keyElement) {
      if (recordingShortcut) {
        cancelRecordingShortcut();
      }
      
      recordingShortcut = { action, element: keyElement, keys: [] };
      keyElement.classList.add('recording');
      keyElement.textContent = 'Press keys...';
      updateStatus(`Recording shortcut for: ${customShortcuts[action].description}`);
    }
    
    // ÂèñÊ∂àÂΩïÂà∂Âø´Êç∑ÈîÆ
    function cancelRecordingShortcut() {
      if (!recordingShortcut) return;
      
      recordingShortcut.element.classList.remove('recording', 'conflict');
      recordingShortcut.element.textContent = formatShortcutDisplay(customShortcuts[recordingShortcut.action].keys);
      recordingShortcut = null;
      updateStatus('Shortcut recording cancelled');
    }
    
    // ‰øùÂ≠òÂΩïÂà∂ÁöÑÂø´Êç∑ÈîÆ
    function saveRecordedShortcut(keys) {
      if (!recordingShortcut || keys.length === 0) return;
      
      const { action, element } = recordingShortcut;
      
      // Ê£ÄÊü•ÂÜ≤Á™Å
      const conflictAction = findShortcutConflict(keys, action);
      if (conflictAction) {
        element.classList.add('conflict');
        element.textContent = `Conflict with: ${customShortcuts[conflictAction].description}`;
        updateStatus(`Shortcut conflicts with: ${customShortcuts[conflictAction].description}`);
        setTimeout(() => {
          element.classList.remove('conflict');
          element.textContent = formatShortcutDisplay(keys);
        }, 2000);
        return;
      }
      
      // ‰øùÂ≠òÊñ∞Âø´Êç∑ÈîÆ
      customShortcuts[action].keys = [...keys];
      saveCustomShortcuts();
      
      element.classList.remove('recording');
      element.textContent = formatShortcutDisplay(keys);
      recordingShortcut = null;
      
      updateStatus(`Shortcut updated for: ${customShortcuts[action].description}`);
      updateShortcutsInfo();
    }
    
    // Êü•ÊâæÂø´Êç∑ÈîÆÂÜ≤Á™Å
    function findShortcutConflict(keys, excludeAction) {
      const keyString = keys.sort().join('+');
      
      for (const [action, config] of Object.entries(customShortcuts)) {
        if (action === excludeAction) continue;
        if (config.keys.sort().join('+') === keyString) {
          return action;
        }
      }
      
      return null;
    }
    
    // ‰øùÂ≠òËá™ÂÆö‰πâÂø´Êç∑ÈîÆÂà∞localStorage
    function saveCustomShortcuts() {
      localStorage.setItem('customShortcuts', JSON.stringify(customShortcuts));
    }
    
    // ÈáçÁΩÆÊâÄÊúâÂø´Êç∑ÈîÆ
    function resetAllShortcuts() {
      if (confirm('Reset all shortcuts to default? This cannot be undone.')) {
        customShortcuts = { ...defaultShortcuts };
        saveCustomShortcuts();
        renderShortcutsList();
        updateShortcutsInfo();
        updateStatus('All shortcuts reset to default');
      }
    }
    
    // Êõ¥Êñ∞Âø´Êç∑ÈîÆ‰ø°ÊÅØÊòæÁ§∫
    function updateShortcutsInfo() {
      const shortcutsInfo = document.querySelector('.shortcuts-info');
      if (shortcutsInfo) {
        shortcutsInfo.innerHTML = `
          <strong>Current Shortcuts:</strong><br>
          ${formatShortcutDisplay(customShortcuts.pass.keys)} Pass<br>
          ${formatShortcutDisplay(customShortcuts.fail.keys)} Fail<br>
          ${formatShortcutDisplay(customShortcuts.save.keys)} Save<br>
          <em>Click "Custom Shortcuts" below to edit all shortcuts</em>
        `;
      }
    }
    
    // ÂàùÂßãÂåñÊ†áÁ≠æÁ≥ªÁªü
    function initTagSystem() {
      console.log('Initializing tag system...');
      
      // Ê£ÄÊü•ÂøÖË¶ÅÁöÑDOMÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
      if (!presetTagsContainer) {
        console.error('presetTagsContainer not found!');
        return;
      }
      if (!addTagBtn) {
        console.error('addTagBtn not found!');
        return;
      }
      
      console.log('DOM elements found, proceeding with tag system initialization...');
      
      // ‰ªélocalStorageÂä†ËΩΩÈ¢ÑËÆæÊ†áÁ≠æ
      const savedPresetTags = localStorage.getItem('presetTags');
      console.log('Saved preset tags:', savedPresetTags);
      
      if (savedPresetTags) {
        try {
          presetTags = JSON.parse(savedPresetTags);
          console.log('Loaded preset tags from storage:', presetTags);
        } catch (e) {
          console.error('Failed to load preset tags:', e);
          presetTags = [...defaultPresetTags];
          console.log('Using default preset tags:', presetTags);
        }
      } else {
        presetTags = [...defaultPresetTags];
        console.log('No saved preset tags, using defaults:', presetTags);
        // Á´ãÂç≥‰øùÂ≠òÈªòËÆ§Ê†áÁ≠æÂà∞ localStorage
        savePresetTags();
      }
      
      // ‰ªélocalStorageÂä†ËΩΩËá™ÂÆö‰πâÊ†áÁ≠æ
      const savedCustomTags = localStorage.getItem('customTags');
      console.log('Saved custom tags:', savedCustomTags);
      
      if (savedCustomTags) {
        try {
          customTags = JSON.parse(savedCustomTags);
          console.log('Loaded custom tags from storage:', customTags);
        } catch (e) {
          console.error('Failed to load custom tags:', e);
          customTags = [];
        }
      }
      
      // Ê∏≤ÊüìÊâÄÊúâÊ†áÁ≠æ
      console.log('About to render all tags...');
      renderAllTags();
      console.log('Tag system initialization completed');
    }
    
    // Ê∏≤ÊüìÊâÄÊúâÊ†áÁ≠æ
    function renderAllTags() {
      console.log('Rendering all tags...');
      console.log('Preset tags to render:', presetTags);
      console.log('Custom tags to render:', customTags);
      
      // Ê£ÄÊü•ÂøÖË¶ÅÁöÑDOMÂÖÉÁ¥†
      if (!presetTagsContainer) {
        console.error('presetTagsContainer is null, cannot render tags');
        return;
      }
      if (!addTagBtn) {
        console.error('addTagBtn is null, cannot render tags');
        return;
      }
      
      // Ê∏ÖÁ©∫ÂÆπÂô®Ôºà‰ΩÜ‰øùÁïôAdd TagÊåâÈíÆÔºâ
      const existingTags = presetTagsContainer.querySelectorAll('.preset-tag');
      console.log('Removing existing tags:', existingTags.length);
      existingTags.forEach(tag => tag.remove());
      
      // Ê∏≤ÊüìÈ¢ÑËÆæÊ†áÁ≠æ
      presetTags.forEach((tagText, index) => {
        const tag = createTagElement(tagText, index + 1, 'preset');
        if (tag) {
          presetTagsContainer.insertBefore(tag, addTagBtn);
          console.log(`Rendered preset tag ${index + 1}: ${tagText}`);
        } else {
          console.error(`Failed to create preset tag: ${tagText}`);
        }
      });
      
      // Ê∏≤ÊüìËá™ÂÆö‰πâÊ†áÁ≠æ
      customTags.forEach((tagText, index) => {
        const shortcut = presetTags.length + index + 1;
        if (shortcut <= 9) { // Âè™ÊúâÂâç9‰∏™Ê†áÁ≠æÊîØÊåÅÂø´Êç∑ÈîÆ
          const tag = createTagElement(tagText, shortcut, 'custom');
          if (tag) {
            presetTagsContainer.insertBefore(tag, addTagBtn);
            console.log(`Rendered custom tag ${shortcut}: ${tagText}`);
          } else {
            console.error(`Failed to create custom tag: ${tagText}`);
          }
        }
      });
      
      console.log('All tags rendered successfully');
    }
    
    // ÂàõÂª∫Ê†áÁ≠æÂÖÉÁ¥†
    function createTagElement(tagText, shortcut, type) {
      const tag = document.createElement('span');
      tag.className = type === 'preset' ? 'preset-tag' : 'preset-tag custom-tag';
      tag.textContent = tagText;
      tag.dataset.tag = tagText;
      tag.dataset.type = type;
      
      if (shortcut) {
        tag.dataset.shortcut = shortcut;
        tag.title = `Ctrl+${shortcut} to use${type === 'preset' ? ', double-click to edit' : ', right-click to delete'}`;
      } else {
        tag.title = type === 'preset' ? 'Double-click to edit' : 'Right-click to delete (no shortcut)';
      }
      
      // Â∑¶ÈîÆÁÇπÂáªÊ∑ªÂä†Ê†áÁ≠æ
      tag.addEventListener('click', () => {
        appendIssueTag(tagText);
      });
      
      // ÂèåÂáªÁºñËæëÊ†áÁ≠æ
      tag.addEventListener('dblclick', (e) => {
        e.preventDefault();
        startEditingTag(tag, tagText, type);
      });
      
      // Âè≥ÈîÆÂà†Èô§Ëá™ÂÆö‰πâÊ†áÁ≠æ
      if (type === 'custom') {
        tag.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          if (confirm(`Delete custom tag "${tagText}"?`)) {
            deleteCustomTag(tagText);
          }
        });
      }
      
      return tag;
    }
    
    // ÂºÄÂßãÁºñËæëÊ†áÁ≠æ
    function startEditingTag(tagElement, currentText, type) {
      currentEditingTag = { element: tagElement, text: currentText, type: type };
      editTagText.value = currentText;
      editTagInput.classList.remove('hidden');
      editTagText.focus();
      editTagText.select();
    }
    
    // ‰øùÂ≠òÁºñËæëÁöÑÊ†áÁ≠æ
    function saveEditedTag() {
      if (!currentEditingTag) return;
      
      const newText = editTagText.value.trim();
      if (!newText) {
        updateStatus('Tag name cannot be empty');
        return;
      }
      
      if (newText.length > 20) {
        updateStatus('Tag name too long (max 20 characters)');
        return;
      }
      
      const { text: oldText, type } = currentEditingTag;
      
      // Ê£ÄÊü•ÊòØÂê¶‰∏éÂÖ∂‰ªñÊ†áÁ≠æÈáçÂ§ç
      const allTags = [...presetTags, ...customTags];
      if (allTags.includes(newText) && newText !== oldText) {
        updateStatus('Tag name already exists');
        return;
      }
      
      if (type === 'preset') {
        const index = presetTags.indexOf(oldText);
        if (index !== -1) {
          presetTags[index] = newText;
          savePresetTags();
          updateStatus(`Preset tag "${oldText}" updated to "${newText}"`);
        }
      } else {
        const index = customTags.indexOf(oldText);
        if (index !== -1) {
          customTags[index] = newText;
          saveCustomTags();
          updateStatus(`Custom tag "${oldText}" updated to "${newText}"`);
        }
      }
      
      renderAllTags();
      cancelEditingTag();
    }
    
    // ÂèñÊ∂àÁºñËæëÊ†áÁ≠æ
    function cancelEditingTag() {
      currentEditingTag = null;
      editTagText.value = '';
      editTagInput.classList.add('hidden');
    }
    
    // ‰øùÂ≠òÈ¢ÑËÆæÊ†áÁ≠æÂà∞localStorage
    function savePresetTags() {
      localStorage.setItem('presetTags', JSON.stringify(presetTags));
    }
    
    // ÂàùÂßãÂåñËá™ÂÆö‰πâÊ†áÁ≠æ
    function initCustomTags() {
      // Ëøô‰∏™ÂáΩÊï∞Áé∞Âú®Áî±initTagSystem()Â§ÑÁêÜ
    }
    
    // Ê∏≤ÊüìËá™ÂÆö‰πâÊ†áÁ≠æ
    function renderCustomTags() {
      // Ëøô‰∏™ÂáΩÊï∞Áé∞Âú®Áî±renderAllTags()Â§ÑÁêÜ
    }
    
    // ‰øùÂ≠òËá™ÂÆö‰πâÊ†áÁ≠æÂà∞localStorage
    function saveCustomTags() {
      localStorage.setItem('customTags', JSON.stringify(customTags));
    }
    
    // Ê∑ªÂä†Ëá™ÂÆö‰πâÊ†áÁ≠æ
    function addCustomTag(tagText) {
      if (!tagText || tagText.trim() === '') return;
      
      tagText = tagText.trim();
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const allTags = [...presetTags, ...customTags];
      if (allTags.includes(tagText)) {
        updateStatus('Tag already exists');
        return;
      }
      
      // Ê£ÄÊü•ÈïøÂ∫¶ÈôêÂà∂
      if (tagText.length > 20) {
        updateStatus('Tag name too long (max 20 characters)');
        return;
      }
      
      customTags.push(tagText);
      saveCustomTags();
      renderAllTags();
      updateStatus(`Custom tag "${tagText}" added`);
    }
    
    // Âà†Èô§Ëá™ÂÆö‰πâÊ†áÁ≠æ
    function deleteCustomTag(tagText) {
      const index = customTags.indexOf(tagText);
      if (index !== -1) {
        customTags.splice(index, 1);
        saveCustomTags();
        renderAllTags();
        updateStatus(`Custom tag "${tagText}" deleted`);
      }
    }
    
    // È¢ÑÂä†ËΩΩÈÄªËæë
    // Auto-preload around current page
    async function preloadAroundCurrentPage() {
      if (!excelData || excelData.length <= 1) return;
      
      try {
        const maxPreloadPages = parseInt(preloadCountSelect.value) || 0;
        if (maxPreloadPages === 0) {
          updatePreloadStatus('0 pages preloaded (disabled)');
          return;
        }
        
        const result = await ipcRenderer.invoke('dynamic-preload', {
          currentIndex: currentIndex,
          totalPages: excelData.length - 1,
          maxPreloadPages: maxPreloadPages,
          excelData: excelData,
          columns: columns
        });
        
        if (result.success) {
          updatePreloadStatus(`${result.preloadCount || result.cachedCount || 0} pages preloaded`);
        } else {
          updatePreloadStatus('Preload failed');
        }
      } catch (error) {
        console.log('Preload error:', error);
        updatePreloadStatus('Preload error');
      }
    }
    
    function updatePreloadStatus(message) {
      preloadStatusEl.textContent = message;
    }
    
    // Load specific page
    async function loadPage(index) {
      if (!excelData || excelData.length <= 1) return;
      
      // Auto-save previous page when navigating
      if (currentIndex !== index) {
        autoSave();
      }
      
      const maxIndex = excelData.length - 1;
      currentIndex = Math.max(1, Math.min(index, maxIndex)); // Á°Æ‰øù‰∏çÂ∞è‰∫é1ÔºàË∑≥ËøáÊ†áÈ¢òË°åÔºâ
      
      // Update page jump input value
      pageJumpInput.value = currentIndex;
      
      // Update navigation buttons
      prevBtn.disabled = currentIndex <= 1; // Á¨¨‰∏ÄÈ°µÊòØÁ¥¢Âºï1
      nextBtn.disabled = currentIndex >= maxIndex;
      
      // Update progress (Âü∫‰∫éÂÆûÈôÖÊï∞ÊçÆÈ°µÊï∞Ôºå‰∏çÂåÖÊã¨Ê†áÈ¢òË°å)
      const totalDataPages = maxIndex; // ÊÄªÊï∞ÊçÆÈ°µÊï∞
      const currentDataPage = currentIndex; // ÂΩìÂâçÊï∞ÊçÆÈ°µ
      const progress = totalDataPages > 0 ? (currentDataPage / totalDataPages) * 100 : 0;
      progressFill.style.width = `${progress}%`;
      
      const rowData = excelData[currentIndex];
      if (!rowData) return;
      
      // Update page counter (ÊòæÁ§∫ÁªôÁî®Êà∑ÁöÑÈ°µÁ†ÅÔºå‰ªé1ÂºÄÂßã)
      pageCounterEl.textContent = `${currentIndex}/${maxIndex}`;
      
      // Load query data
      const queryData = rowData[columns.description] || rowData[columns.query] || 'N/A';
      currentQueryEl.textContent = queryData;
      
      // Load URL
      const url = rowData[columns.link];
      currentUrlEl.textContent = url || '-';
      currentUrlEl.href = url || '#';
      
      if (url && url.trim() && url.startsWith('http') && displayMode !== 'response') {
        // Âè™Âú®ÈùûresponseÊ®°Âºè‰∏ãÂä†ËΩΩBrowserView
        // Ëé∑ÂèñwebFrameÁöÑÂáÜÁ°Æ‰ΩçÁΩÆ
        const rect = webFrame.getBoundingClientRect();
        const targetBounds = {
          x: Math.round(rect.left),
          y: Math.round(rect.top),
          width: Math.round(rect.width),
          height: Math.round(rect.height)
        };
        
        // È¶ñÂÖàÂ∞ùËØïÂàáÊç¢Âà∞È¢ÑÂä†ËΩΩÁöÑBrowserViewÔºå‰º†ÈÄíÂáÜÁ°ÆÁöÑbounds
        const switchResult = await ipcRenderer.invoke('switch-to-preloaded', url, targetBounds);
        
        if (switchResult.success && switchResult.preloaded) {
          // ÊàêÂäüÂàáÊç¢Âà∞È¢ÑÂä†ËΩΩÈ°µÈù¢ÔºåÊó†Âä®Êïà
          updateStatus(`‚ö° Loaded: ${url} (instant from cache)`);
          webFrame.innerHTML = '<div style="text-align: center; padding: 20px; color: #4285f4;"><div style="margin-bottom: 10px;">‚ö° Cached website - instant loading!</div><div style="font-size: 12px; color: #666;">This page was loaded from cache and switched instantly</div></div>';
          
          // boundsÂ∑≤ÁªèÂú®ÂêéÁ´ØËÆæÁΩÆÂ•Ω‰∫ÜÔºå‰∏çÈúÄË¶ÅÂÜçÊ¨°Ë∞ÉÊï¥
        } else {
          // ÂõûÈÄÄÂà∞Ê≠£Â∏∏Âä†ËΩΩÊµÅÁ®ã
          updateStatus(`Loading: ${url}`);
          webFrame.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">üîÑ Loading website...</div>';
          
          // Adjust BrowserView position first
          adjustBrowserViewPosition();
          
          // Use IPC to load URL in BrowserView
          const loadResult = await ipcRenderer.invoke('load-url', url);
          if (loadResult.success) {
            webFrame.innerHTML = '<div style="text-align: center; padding: 20px; color: #4285f4;"><div style="margin-bottom: 10px;">‚úÖ Website loaded successfully</div><div style="font-size: 12px; color: #666;">You can see the actual website content in the embedded browser view</div></div>';
            updateStatus('Website loaded successfully');
          } else {
            webFrame.innerHTML = `
              <div style="text-align: center; padding: 20px; color: #d32f2f;">
                <div style="margin-bottom: 15px;">‚ö†Ô∏è Website could not be embedded</div>
                <div style="font-size: 12px; color: #666; margin-bottom: 15px;">
                  This is common with some websites due to security restrictions.<br/>
                  You can still use the "Open in Browser" button below to view it.
                </div>
                <div style="font-size: 11px; color: #999;">Error: ${loadResult.error}</div>
              </div>
            `;
            updateStatus(`Failed to load website: ${loadResult.error}`);
          }
        }
      } else if (displayMode === 'response') {
        // ResponseÊ®°Âºè‰∏ãÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
        webFrame.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">üìÑ Response mode - Web content is hidden</div>';
        updateStatus('Response mode active');
      } else {
        webFrame.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">üìù No valid URL available for this entry</div>';
        updateStatus('No valid URL available');
      }
      
      // Load score data
      const resultData = rowData[columns.result];
      if (resultData === 1) {
        currentScoreEl.textContent = '‚úÖ Passed (1)';
        currentScoreEl.style.color = '#388e3c';
        updateContainerStatus(1);
      } else if (resultData === 0) {
        currentScoreEl.textContent = '‚ùå Failed (0)';
        currentScoreEl.style.color = '#d32f2f';
        updateContainerStatus(0);
      } else {
        currentScoreEl.textContent = 'Not scored';
        currentScoreEl.style.color = '#666';
        updateContainerStatus(null);
      }
      
      // Load thumbnail
      const thumbnailUrl = rowData[columns.thumbnail_link];
      if (thumbnailUrl) {
        thumbnailPreview.src = thumbnailUrl;
        thumbnailPreview.classList.remove('hidden');
        thumbnailPlaceholder.style.display = 'none';
        thumbnailPreview.onerror = () => {
          thumbnailPreview.classList.add('hidden');
          thumbnailPlaceholder.style.display = 'block';
        };
      } else {
        thumbnailPreview.classList.add('hidden');
        thumbnailPlaceholder.style.display = 'block';
      }
      
      // Load screenshot data
      const screenshotData = rowData[columns.screenshot];
      if (screenshotData) {
        if (screenshotData.startsWith('screenshots/') || screenshotData.includes('/')) {
          // File path - load from file
          ipcRenderer.invoke('load-screenshot', screenshotData).then(result => {
            if (result.success) {
              const imgSrc = `data:image/png;base64,${result.data}`;
              screenshotPreview.src = imgSrc;
        screenshotPreview.classList.remove('hidden');
              noScreenshotDiv.style.display = 'none';
              screenshotPreview.onclick = () => {
                const newWindow = window.open();
                newWindow.document.write(`<img src="${imgSrc}" style="max-width: 100%; max-height: 100vh; object-fit: contain;">`);
              };
      } else {
        screenshotPreview.classList.add('hidden');
              noScreenshotDiv.style.display = 'flex';
            }
          });
      } else {
          // Legacy base64 without data prefix
          const imgSrc = `data:image/png;base64,${screenshotData}`;
          screenshotPreview.src = imgSrc;
          screenshotPreview.classList.remove('hidden');
          noScreenshotDiv.style.display = 'none';
          screenshotPreview.onclick = () => {
            const newWindow = window.open();
            newWindow.document.write(`<img src="${imgSrc}" style="max-width: 100%; max-height: 100vh; object-fit: contain;">`);
          };
        }
      } else {
        screenshotPreview.classList.add('hidden');
        noScreenshotDiv.style.display = 'flex';
        screenshotPreview.onclick = null;
      }
      
      // Load issue data
      const issueData = rowData[columns.issue] || '';
      issueInput.value = issueData;
      
      // Ëß¶ÂèëÂä®ÊÄÅÈ¢ÑÂä†ËΩΩ
      preloadAroundCurrentPage();
      
      // Êõ¥Êñ∞Progress Overview
      updateProgressOverview();
      
      // Êõ¥Êñ∞ResponseÈù¢Êùø
      updateResponsePanel();
      
      // Ê†πÊçÆÂΩìÂâçÊòæÁ§∫Ê®°ÂºèÊõ¥Êñ∞ÂÜÖÂÆπ
      if (displayMode === 'response') {
        updateResponseViewMode();
      } else if (displayMode === 'web') {
        updateResponsePanel(); // Êõ¥Êñ∞‰æßËæπÊ†èÁöÑresponseÂÜÖÂÆπ  
        updateResponseViewMode(); // Êõ¥Êñ∞Âè≥‰æß‰∏ªÊòæÁ§∫Âå∫ÂüüÁöÑresponseÂÜÖÂÆπ
      } else if (displayMode === 'webonly') {
        updateResponsePanel(); // Êõ¥Êñ∞‰æßËæπÊ†èÁöÑresponseÂÜÖÂÆπ
      }
    }
    
    // Event listeners
    prevBtn.addEventListener('click', () => loadPage(currentIndex - 1));
    nextBtn.addEventListener('click', () => loadPage(currentIndex + 1));
    
    // ÊòæÁ§∫Ê®°ÂºèÂàáÊç¢‰∫ã‰ª∂ÁõëÂê¨Âô®
    webModeBtn.addEventListener('click', () => switchDisplayMode('web'));
    responseModeBtn.addEventListener('click', () => switchDisplayMode('response'));
    webonlyModeBtn.addEventListener('click', () => switchDisplayMode('webonly'));
    
    // ‰øÆÊîπPassÊåâÈíÆË°å‰∏∫ÔºåÊîØÊåÅËá™Âä®Ë∑≥ËΩ¨
    passBtn.addEventListener('click', () => {
      excelData[currentIndex][columns.result] = 1;
      currentScoreEl.textContent = '‚úÖ Passed (1)';
      currentScoreEl.style.color = '#388e3c';
      updateContainerStatus(1);
      updateStatus('Marked as Passed');
      // Auto-save after scoring
      autoSave();
      
      // Êõ¥Êñ∞Progress Overview
      updateProgressOverview();
      
      // Ëá™Âä®Ë∑≥ËΩ¨Âà∞‰∏ã‰∏ÄÈ°µÔºàÂ¶ÇÊûúÂºÄÂêØ‰∫ÜËá™Âä®Ë∑≥ËΩ¨Ôºâ
      if (autoNextEnabled && currentIndex < excelData.length - 1) {
        setTimeout(() => {
          loadPage(currentIndex + 1);
        }, 300); // 300msÂª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ÂèçÈ¶à
      }
    });
    
    failBtn.addEventListener('click', () => {
      excelData[currentIndex][columns.result] = 0;
      currentScoreEl.textContent = '‚ùå Failed (0)';
      currentScoreEl.style.color = '#d32f2f';
      updateContainerStatus(0);
      updateStatus('Marked as Failed');
      // Auto-save after scoring
      autoSave();
      
      // Êõ¥Êñ∞Progress Overview
      updateProgressOverview();
      
      // Ëá™Âä®Ë∑≥ËΩ¨Âà∞‰∏ã‰∏ÄÈ°µÔºàÂ¶ÇÊûúÂºÄÂêØ‰∫ÜËá™Âä®Ë∑≥ËΩ¨Â§±Ë¥•Ôºâ
      if (autoNextFailEnabled && currentIndex < excelData.length - 1) {
        setTimeout(async () => {
          await loadPage(currentIndex + 1);
        }, 300); // 300msÂª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ÂèçÈ¶à
      }
    });
    
    screenshotBtn.addEventListener('click', async () => {
      try {
        updateStatus('Taking screenshot...');
        const result = await ipcRenderer.invoke('take-screenshot');
        
        if (result.success) {
          // Use base64 for immediate display
          const screenshotData = `data:image/png;base64,${result.screenshot}`;
          screenshotPreview.src = screenshotData;
          screenshotPreview.classList.remove('hidden');
          noScreenshotDiv.style.display = 'none';
          
          // Save file path to Excel (not base64 to avoid character limit)
          excelData[currentIndex][columns.screenshot] = result.filepath;
          
          screenshotPreview.onclick = () => {
            const newWindow = window.open();
            newWindow.document.write(`<img src="${screenshotData}" style="max-width: 100%; max-height: 100vh; object-fit: contain;">`);
          };
          
          updateStatus('Screenshot taken and saved successfully');
          // Auto-save after taking screenshot
          autoSave();
        } else {
          showError('Failed to take screenshot');
        }
      } catch (error) {
        showError(`Screenshot failed: ${error.message}`);
      }
    });
    
    saveBtn.addEventListener('click', async () => {
      try {
        updateStatus('Saving results...');
        await ipcRenderer.invoke('save-excel', excelData);
        updateStatus('‚úÖ Results manually saved successfully');
      } catch (error) {
        showError(`Save failed: ${error.message}`);
      }
    });
    
    reloadBtn.addEventListener('click', () => loadExcelData());
    
    refreshBtn.addEventListener('click', async () => {
      try {
        updateStatus('Refreshing current page...');
        const url = excelData[currentIndex] && excelData[currentIndex][columns.link];
        if (url && url.trim() && url.startsWith('http')) {
          // Âº∫Âà∂ÈáçÊñ∞Âä†ËΩΩÂΩìÂâçURL
          const result = await ipcRenderer.invoke('refresh-current-page', url);
          if (result.success) {
            updateStatus('‚úÖ Page refreshed successfully');
          } else {
            updateStatus(`Failed to refresh page: ${result.error}`);
          }
        } else {
          updateStatus('No valid URL to refresh');
        }
      } catch (error) {
        showError(`Refresh failed: ${error.message}`);
      }
    });
    
    openExternalBtn.addEventListener('click', () => {
      const url = excelData[currentIndex] && excelData[currentIndex][columns.link];
      if (url) {
        shell.openExternal(url);
        updateStatus('Page opened in external browser');
      }
    });
    
    // Issue input event listener
    let issueInputTimeout;
    issueInput.addEventListener('input', (e) => {
      if (excelData[currentIndex]) {
        excelData[currentIndex][columns.issue] = e.target.value;
        updateStatus('Issue note updated');
        
        // Ê£ÄÊü•Ëá™Âä®failÂäüËÉΩ
      if (autoFailEnabled) {
          const issueText = e.target.value.trim();
          if (issueText && excelData[currentIndex][columns.result] !== 0) {
            // ÊúâissueÂÜÖÂÆπ‰∏îÂΩìÂâç‰∏çÊòØfailÁä∂ÊÄÅÔºåËá™Âä®ËÆæ‰∏∫fail
            excelData[currentIndex][columns.result] = 0;
            currentScoreEl.textContent = '‚ùå Failed (0)';
            currentScoreEl.style.color = '#d32f2f';
            updateContainerStatus(0);
            updateStatus('Auto-failed due to issue content');
            
            // Êõ¥Êñ∞Progress Overview
            updateProgressOverview();
            
            // Ëá™Âä®Ë∑≥ËΩ¨Âà∞‰∏ã‰∏ÄÈ°µÔºàÂ¶ÇÊûúÂºÄÂêØ‰∫ÜËá™Âä®Ë∑≥ËΩ¨Â§±Ë¥•Ôºâ
            if (autoNextFailEnabled && currentIndex < excelData.length - 1) {
              setTimeout(async () => {
                await loadPage(currentIndex + 1);
              }, 300); // 300msÂª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ÂèçÈ¶à
            }
          }
        }
        
        // Clear existing timeout
        clearTimeout(issueInputTimeout);
        
        // Auto-save after 1 second of no typing
        issueInputTimeout = setTimeout(() => {
          autoSave();
        }, 1000);
      }
    });
    
    // Auto-save issue on blur
    issueInput.addEventListener('blur', () => {
      updateStatus('Issue note saved');
      // Clear timeout and save immediately on blur
      clearTimeout(issueInputTimeout);
      autoSave();
    });
    
    // Auto-save function
    async function autoSave() {
      if (excelData && excelData.length > 1) {
        try {
          await ipcRenderer.invoke('save-excel', excelData);
          console.log('Auto-saved data successfully');
          // ÊòæÁ§∫ÁÆÄÁü≠ÁöÑËá™Âä®‰øùÂ≠òÊèêÁ§∫
          const originalText = statusEl.textContent;
          const originalBg = statusEl.style.backgroundColor;
          const originalColor = statusEl.style.color;
          
          statusEl.textContent = 'üíæ Auto-saved';
          statusEl.style.backgroundColor = '#e8f5e8';
          statusEl.style.color = '#2e7d32';
          
          // 2ÁßíÂêéÊÅ¢Â§çÂéüÁä∂ÊÄÅ
          setTimeout(() => {
            statusEl.textContent = originalText;
            statusEl.style.backgroundColor = originalBg;
            statusEl.style.color = originalColor;
          }, 2000);
      } catch (error) {
          console.error('Auto-save failed:', error);
          // ‰∏çÊòæÁ§∫ÈîôËØØÁªôÁî®Êà∑ÔºåÂõ†‰∏∫ËøôÊòØËá™Âä®‰øùÂ≠ò
        }
      }
    }
    
    // Initialize
    // loadExcelData(); // Ê≥®ÈáäÊéâËá™Âä®Âä†ËΩΩÔºåÁé∞Âú®Áî±Êñá‰ª∂ÈÄâÊã©Ëß¶Âèë
    
    // ÂàùÂßãÂåñÂ∫îÁî®
    function initApp() {
      console.log('=== Starting App Initialization ===');
      
      // Ê£ÄÊü•ÂÖ≥ÈîÆDOMÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
      const criticalElements = {
        'presetTagsContainer': presetTagsContainer,
        'addTagBtn': addTagBtn,
        'shortcutsList': shortcutsList,
        'webModeBtn': webModeBtn,
        'responseModeBtn': responseModeBtn,
        'webonlyModeBtn': webonlyModeBtn
      };
      
      console.log('DOM Elements Check:');
      let allElementsFound = true;
      for (const [name, element] of Object.entries(criticalElements)) {
        const found = element !== null;
        console.log(`  ${name}: ${found ? '‚úÖ Found' : '‚ùå Missing'}`);
        if (!found) allElementsFound = false;
      }
      
      if (!allElementsFound) {
        console.error('Some critical DOM elements are missing! Initialization may fail.');
        // Âª∂ËøüÈáçËØï
        setTimeout(() => {
          console.log('Retrying initialization...');
          initApp();
        }, 100);
        return;
      }
      
      console.log('All critical DOM elements found, proceeding with initialization...');
      
      // ÂàùÂßãÂåñÂºÄÂÖ≥Áä∂ÊÄÅ
      autoNextToggle.classList.add('active');
      
      // ÂàùÂßãÂåñÊòæÁ§∫Ê®°Âºè
      displayMode = 'web'; // ÈªòËÆ§‰∏∫webÊ®°Âºè
      webModeBtn.classList.add('active');
      responseModeBtn.classList.remove('active');
      webonlyModeBtn.classList.remove('active');
      webView.classList.remove('hidden', 'webonly');
      responseViewMode.classList.add('hidden');
      
      // ÂàùÂßãÂåñÊó∂ÈöêËóèBrowserView
      hideBrowserView();
      
      // ÂàùÂßãÂåñÊ†áÁ≠æÂäüËÉΩ
      console.log('Initializing tag system...');
      initTagSystem();
      
      // ÂàùÂßãÂåñËá™ÂÆö‰πâÂø´Êç∑ÈîÆÂäüËÉΩ
      console.log('Initializing custom shortcuts...');
      initCustomShortcuts();
      
      console.log('=== App Initialization Completed ===');
    }
    
    // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', initApp);
    
    // Ê∑ªÂä†Ê†áÁ≠æÊåâÈíÆ‰∫ã‰ª∂
    addTagBtn.addEventListener('click', () => {
      addTagInput.classList.remove('hidden');
      newTagInput.focus();
    });
    
    // ‰øùÂ≠òÊñ∞Ê†áÁ≠æ
    saveTagBtn.addEventListener('click', () => {
      const tagText = newTagInput.value.trim();
      if (tagText) {
        addCustomTag(tagText);
        newTagInput.value = '';
        addTagInput.classList.add('hidden');
      }
    });
    
    // ÂèñÊ∂àÊ∑ªÂä†Ê†áÁ≠æ
    cancelTagBtn.addEventListener('click', () => {
      newTagInput.value = '';
      addTagInput.classList.add('hidden');
    });
    
    // Êñ∞Ê†áÁ≠æËæìÂÖ•Ê°ÜÂõûËΩ¶‰∫ã‰ª∂
    newTagInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        saveTagBtn.click();
      } else if (e.key === 'Escape') {
        cancelTagBtn.click();
      }
    });
    
    // ÁºñËæëÊ†áÁ≠æ‰∫ã‰ª∂ÁõëÂê¨Âô®
    saveEditBtn.addEventListener('click', saveEditedTag);
    cancelEditBtn.addEventListener('click', cancelEditingTag);
    
    // ÁºñËæëÊ†áÁ≠æËæìÂÖ•Ê°ÜÂõûËΩ¶‰∫ã‰ª∂
    editTagText.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        saveEditedTag();
      } else if (e.key === 'Escape') {
        cancelEditingTag();
      }
    });
    
    // Ê†áÁ≠æÁõ∏ÂÖ≥ÂáΩÊï∞
    function appendIssueTag(tagText) {
      const currentValue = issueInput.value.trim();
      if (currentValue) {
        issueInput.value = currentValue + ', ' + tagText;
      } else {
        issueInput.value = tagText;
      }
      
      // Êõ¥Êñ∞ExcelÊï∞ÊçÆ
      if (excelData[currentIndex]) {
        excelData[currentIndex][columns.issue] = issueInput.value;
        updateStatus(`Added tag: ${tagText}`);
        
        // Ê£ÄÊü•Ëá™Âä®failÂäüËÉΩ
        if (autoFailEnabled && issueInput.value.trim() && excelData[currentIndex][columns.result] !== 0) {
          // ÊúâissueÂÜÖÂÆπ‰∏îÂΩìÂâç‰∏çÊòØfailÁä∂ÊÄÅÔºåËá™Âä®ËÆæ‰∏∫fail
          excelData[currentIndex][columns.result] = 0;
          currentScoreEl.textContent = '‚ùå Failed (0)';
          currentScoreEl.style.color = '#d32f2f';
          updateContainerStatus(0);
          updateStatus('Auto-failed due to issue tag');
          
          // Êõ¥Êñ∞Progress Overview
          updateProgressOverview();
          
          // Ëá™Âä®Ë∑≥ËΩ¨Âà∞‰∏ã‰∏ÄÈ°µÔºàÂ¶ÇÊûúÂºÄÂêØ‰∫ÜËá™Âä®Ë∑≥ËΩ¨Â§±Ë¥•Ôºâ
          if (autoNextFailEnabled && currentIndex < excelData.length - 1) {
            setTimeout(async () => {
              await loadPage(currentIndex + 1);
            }, 300); // 300msÂª∂ËøüËÆ©Áî®Êà∑ÁúãÂà∞ÂèçÈ¶à
          }
        }
        
        autoSave();
      }
    }
    
    function clearIssueInput() {
      issueInput.value = '';
      if (excelData[currentIndex]) {
        excelData[currentIndex][columns.issue] = '';
        updateStatus('Issue notes cleared');
        autoSave();
      }
    }
    
    // Ëá™Âä®Ë∑≥ËΩ¨ÂºÄÂÖ≥‰∫ã‰ª∂
      autoNextToggle.addEventListener('click', () => {
        autoNextEnabled = !autoNextEnabled;
        autoNextToggle.classList.toggle('active', autoNextEnabled);
      updateStatus(autoNextEnabled ? 'Auto-advance enabled' : 'Auto-advance disabled');
      });
      
    // Ëá™Âä®FailÂºÄÂÖ≥‰∫ã‰ª∂
      autoFailToggle.addEventListener('click', () => {
        autoFailEnabled = !autoFailEnabled;
        autoFailToggle.classList.toggle('active', autoFailEnabled);
      updateStatus(autoFailEnabled ? 'Auto-fail on issue enabled' : 'Auto-fail on issue disabled');
    });
    
    // Ëá™Âä®FailÂêéË∑≥ËΩ¨ÂºÄÂÖ≥‰∫ã‰ª∂
    autoNextFailToggle.addEventListener('click', () => {
      autoNextFailEnabled = !autoNextFailEnabled;
      autoNextFailToggle.classList.toggle('active', autoNextFailEnabled);
      updateStatus(autoNextFailEnabled ? 'Auto-advance after fail enabled' : 'Auto-advance after fail disabled');
    });
    
    // È¢ÑÂä†ËΩΩÈ°µÊï∞ËÆæÁΩÆ‰∫ã‰ª∂
    preloadCountSelect.addEventListener('change', (e) => {
      maxPreloadPages = parseInt(e.target.value);
      updateStatus(`Preload count set to ${maxPreloadPages} pages`);
      
      // ÈáçÊñ∞ÂºÄÂßãÈ¢ÑÂä†ËΩΩ
      if (excelData && excelData.length > 1) {
        preloadAroundCurrentPage();
      }
    });
    
    // È°µÁ†ÅË∑≥ËΩ¨‰∫ã‰ª∂
    jumpBtn.addEventListener('click', () => {
      const targetPage = parseInt(pageJumpInput.value);
      const maxPage = excelData ? excelData.length - 1 : 1;
      
      if (targetPage >= 1 && targetPage <= maxPage) {
        loadPage(targetPage);
        updateStatus(`Jumped to page ${targetPage}`);
      } else {
        showError(`Invalid page number. Please enter a number between 1 and ${maxPage}`);
        pageJumpInput.value = currentIndex;
      }
    });
    
    // È°µÁ†ÅËæìÂÖ•Ê°ÜÂõûËΩ¶‰∫ã‰ª∂
    pageJumpInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        jumpBtn.click();
      }
    });
    
    // Ëá™ÂÆö‰πâÂø´Êç∑ÈîÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
    resetShortcutsBtn.addEventListener('click', resetAllShortcuts);
    
    toggleShortcutsBtn.addEventListener('click', () => {
      shortcutsVisible = !shortcutsVisible;
      const shortcutsPanel = document.getElementById('shortcuts-config-panel');
      if (shortcutsVisible) {
        shortcutsPanel.style.display = 'block';
        toggleShortcutsBtn.textContent = '‚å®Ô∏è Hide Custom Shortcuts';
        toggleShortcutsBtn.style.backgroundColor = '#dc3545';
      } else {
        shortcutsPanel.style.display = 'none';
        toggleShortcutsBtn.textContent = '‚å®Ô∏è Custom Shortcuts';
        toggleShortcutsBtn.style.backgroundColor = '#6c757d';
      }
    });
    
    // ÂàùÂßãÂåñÊó∂ÈöêËóèÂø´Êç∑ÈîÆÈÖçÁΩÆÂàóË°®
    window.addEventListener('load', () => {
      const shortcutsPanel = document.getElementById('shortcuts-config-panel');
      if (shortcutsPanel) {
        shortcutsPanel.style.display = 'none'; // ÈªòËÆ§ÈöêËóè
        shortcutsVisible = false; // ËÆæÁΩÆÁä∂ÊÄÅ‰∏∫ÈöêËóè
        toggleShortcutsBtn.textContent = '‚å®Ô∏è Custom Shortcuts'; // ÊåâÈíÆÊñáÂ≠ó
        toggleShortcutsBtn.style.backgroundColor = '#6c757d'; // ÁÅ∞Ëâ≤ËÉåÊôØ
      }
      
      // ÂàùÂßãÂåñtoggleÊåâÈíÆÁä∂ÊÄÅ
      autoNextToggle.classList.toggle('active', autoNextEnabled); // true = enabled
      autoFailToggle.classList.toggle('active', autoFailEnabled); // false = disabled  
      autoNextFailToggle.classList.toggle('active', autoNextFailEnabled); // false = disabled
    });
    
    // File selection
    fileBtn.addEventListener('click', async () => {
      try {
        const result = await ipcRenderer.invoke('select-file');
        if (result.success) {
          await loadExcelData();
        }
      } catch (error) {
        showError(`File selection failed: ${error.message}`);
      }
    });
    
    // Download sample Excel file
    downloadSampleBtn.addEventListener('click', async () => {
      try {
        updateStatus('Preparing sample Excel template...');
        const result = await ipcRenderer.invoke('download-sample-excel');
        if (result.success) {
          updateStatus(`‚úÖ Sample template saved: ${result.fileName}`);
          
          // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØÂíåÊåáÂºï
          const message = `
            üì• Ê†∑‰æãExcelÊ®°ÊùøÂ∑≤‰∏ãËΩΩÔºÅ
            
            üîß ‰ΩøÁî®ÊåáÂºïÔºö
            1. ÁºñËæëExcelÊñá‰ª∂ÔºåÂ°´ÂÖ•ÊÇ®ÁöÑÁΩëÈ°µÊï∞ÊçÆ
            2. ÂøÖÂ°´ÂàóÔºödescription/queryÔºàÊèèËø∞Ôºâ„ÄÅlinkÔºàÁΩëÈ°µÈìæÊé•Ôºâ
            3. ÂèØÈÄâÂàóÔºöthumbnail_linkÔºàÁº©Áï•ÂõæÔºâ
            4. Á≥ªÁªüÂàóÔºöresultÔºàËØÑÂàÜÁªìÊûúÔºâ„ÄÅissueÔºàÈóÆÈ¢òÂ§áÊ≥®Ôºâ„ÄÅscreenshotÔºàÊà™ÂõæË∑ØÂæÑÔºâ
            
            üìÇ ‰øùÂ≠ò‰ΩçÁΩÆÔºö${result.filePath}
          `;
          
          alert(message);
        } else {
          showError(result.error || 'Failed to download sample template');
        }
      } catch (error) {
        showError(`Download failed: ${error.message}`);
      }
    });
    
    // Áº©Áï•ÂõæÁÇπÂáªÊîæÂ§ß
    thumbnailPreview.addEventListener('click', () => {
      if (thumbnailPreview.src && !thumbnailPreview.classList.contains('hidden')) {
        showFullscreenImage(thumbnailPreview.src);
      }
    });

    // Load Excel data
    async function loadExcelData() {
      try {
        updateStatus('Loading Excel file...');
        const result = await ipcRenderer.invoke('load-excel');
        
        if (result.success) {
          excelData = result.data;
          columns = result.columns;
          currentIndex = 1; // ‰ªé1ÂºÄÂßãÔºåË∑≥ËøáÊ†áÈ¢òË°å
          
          // Êõ¥Êñ∞È°µÁ†ÅË∑≥ËΩ¨ËæìÂÖ•Ê°ÜÁöÑÊúÄÂ§ßÂÄº
          const maxPage = excelData.length - 1;
          pageJumpInput.max = maxPage;
          pageJumpInput.value = 1;
          
          // Enable controls
          prevBtn.disabled = false;
          nextBtn.disabled = false;
          passBtn.disabled = false;
          failBtn.disabled = false;
          screenshotBtn.disabled = false;
          saveBtn.disabled = false;
          reloadBtn.disabled = false;
          refreshBtn.disabled = false;
          openExternalBtn.disabled = false;
          
          updateStatus(`‚úÖ Loaded ${maxPage} pages from Excel file`);
          loadPage(1); // Âä†ËΩΩÁ¨¨‰∏ÄÈ°µÊï∞ÊçÆ
          
          // ÂàùÂßãÂåñProgress Overview
          initializeProgressOverview();
          
          // ÂºÄÂßãÈ¢ÑÂä†ËΩΩ
          preloadAroundCurrentPage();
        } else {
          showError(result.error || 'Failed to load Excel file');
        }
      } catch (error) {
        showError(`Failed to load Excel: ${error.message}`);
      }
    }
    
    // ‰øÆÊîπÈîÆÁõòÂø´Êç∑ÈîÆÔºå‰ΩøÁî®Ëá™ÂÆö‰πâÂø´Êç∑ÈîÆÁ≥ªÁªü
    document.addEventListener('keydown', (e) => {
      // Â¶ÇÊûúÊ≠£Âú®ÂΩïÂà∂Âø´Êç∑ÈîÆÔºåËÆ∞ÂΩïÊåâÈîÆ
      if (recordingShortcut) {
        e.preventDefault();
        
        // ESCÂèñÊ∂àÂΩïÂà∂
        if (e.key === 'Escape') {
          cancelRecordingShortcut();
          return;
        }
        
        // Êî∂ÈõÜÊåâÈîÆÁªÑÂêà
        const keys = [];
        if (e.ctrlKey) keys.push('Control');
        if (e.altKey) keys.push('Alt');
        if (e.shiftKey) keys.push('Shift');
        if (e.metaKey) keys.push('Meta');
        
        // Ê∑ªÂä†‰∏ªÈîÆÔºàËøáÊª§‰øÆÈ•∞ÈîÆÔºâ
        if (!['Control', 'Alt', 'Shift', 'Meta'].includes(e.key)) {
          keys.push(e.key);
        }
        
        if (keys.length > 0) {
          saveRecordedShortcut(keys);
        }
        return;
      }
      
      // Â¶ÇÊûúÁî®Êà∑Âú®ËæìÂÖ•Ê°Ü‰∏≠ÔºåÂè™ÂìçÂ∫îÈÉ®ÂàÜÂø´Êç∑ÈîÆ
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        // ‰øùÂ≠òÂø´Êç∑ÈîÆ
        if (isShortcutMatch(e, customShortcuts.save.keys)) {
          e.preventDefault();
          saveBtn.click();
          return;
        }
        
        // IssueÊ†áÁ≠æÂø´Êç∑ÈîÆÂú®ËæìÂÖ•Ê°Ü‰∏≠‰πüË¶ÅÂìçÂ∫î
        if ((e.ctrlKey || e.metaKey) && !isNaN(e.key)) {
          e.preventDefault();
          const num = parseInt(e.key);
          if (num === 0) {
            clearIssueInput();
          } else if (num >= 1 && num <= 9) {
            const targetTag = document.querySelector(`[data-shortcut="${num}"]`);
            if (targetTag) {
              appendIssueTag(targetTag.dataset.tag);
            }
          }
        }
        return;
      }
      
      // Ê£ÄÊü•ÊâÄÊúâËá™ÂÆö‰πâÂø´Êç∑ÈîÆ
      for (const [action, config] of Object.entries(customShortcuts)) {
        if (isShortcutMatch(e, config.keys)) {
          e.preventDefault();
          executeShortcutAction(action);
          return;
        }
      }
      
      // IssueÊ†áÁ≠æÂø´Êç∑ÈîÆ (Êâ©Â±ïÂà∞1-9)
      if ((e.ctrlKey || e.metaKey) && !isNaN(e.key)) {
        e.preventDefault();
        const num = parseInt(e.key);
        if (num === 0) {
          clearIssueInput();
        } else if (num >= 1 && num <= 9) {
          const targetTag = document.querySelector(`[data-shortcut="${num}"]`);
          if (targetTag) {
            appendIssueTag(targetTag.dataset.tag);
            // ËßÜËßâÂèçÈ¶à
            targetTag.classList.add('active');
            setTimeout(() => targetTag.classList.remove('active'), 200);
          }
        }
      }
    });
    
    // Ê£ÄÊü•Âø´Êç∑ÈîÆÊòØÂê¶ÂåπÈÖç
    function isShortcutMatch(event, shortcutKeys) {
      if (!shortcutKeys || shortcutKeys.length === 0) return false;
      
      const pressedKeys = [];
      if (event.ctrlKey) pressedKeys.push('Control');
      if (event.altKey) pressedKeys.push('Alt');
      if (event.shiftKey) pressedKeys.push('Shift');
      if (event.metaKey) pressedKeys.push('Meta');
      
      // Ê∑ªÂä†‰∏ªÈîÆÔºàËøáÊª§‰øÆÈ•∞ÈîÆÔºâ
      if (!['Control', 'Alt', 'Shift', 'Meta'].includes(event.key)) {
        pressedKeys.push(event.key);
      }
      
      // ÊØîËæÉÊåâÈîÆÁªÑÂêà
      return pressedKeys.sort().join('+') === shortcutKeys.sort().join('+');
    }
    
    // ÊâßË°åÂø´Êç∑ÈîÆÂä®‰Ωú
    async function executeShortcutAction(action) {
      switch (action) {
        case 'previous':
          if (!prevBtn.disabled) await loadPage(currentIndex - 1);
          break;
        case 'next':
          if (!nextBtn.disabled) await loadPage(currentIndex + 1);
          break;
        case 'pass':
          if (!passBtn.disabled) passBtn.click();
          break;
        case 'fail':
          if (!failBtn.disabled) failBtn.click();
          break;
        case 'save':
          saveBtn.click();
          break;
        case 'screenshot':
          if (!screenshotBtn.disabled) screenshotBtn.click();
          break;
        case 'reload':
          if (!reloadBtn.disabled) reloadBtn.click();
          break;
        case 'refresh':
          if (!refreshBtn.disabled) refreshBtn.click();
          break;
        case 'openExternal':
          if (!openExternalBtn.disabled) openExternalBtn.click();
          break;
        case 'clearTags':
          clearIssueInput();
          break;
        case 'toggleAutoNext':
          autoNextToggle.click();
          break;
        case 'focusJump':
          pageJumpInput.focus();
          pageJumpInput.select();
          break;
        default:
          console.log('Unknown shortcut action:', action);
      }
    }
    
    // Ê∑ªÂä†Á™óÂè£Ë∞ÉÊï¥‰∫ã‰ª∂ÁõëÂê¨
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        adjustBrowserViewPosition();
      }, 250);
    });
    
    // Ê∑ªÂä†ÊªöÂä®‰∫ã‰ª∂ÁõëÂê¨ÔºåÊªöÂä®Êó∂ÈöêËóèBrowserView
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      ipcRenderer.invoke('hide-browser-view');
      
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        adjustBrowserViewPosition();
      }, 150);
    });
    
    // BrowserView‰ΩçÁΩÆË∞ÉÊï¥ÂáΩÊï∞
    function adjustBrowserViewPosition() {
      const rect = webFrame.getBoundingClientRect();
      ipcRenderer.invoke('adjust-browser-view', {
        x: Math.round(rect.left),
        y: Math.round(rect.top),
        width: Math.round(rect.width),
        height: Math.round(rect.height)
      });
    }
    
    // Utility functions
    function updateStatus(message) {
      statusEl.textContent = message;
      statusEl.style.backgroundColor = '#f2f2f2';
      statusEl.style.color = '#333';
    }
    
    function showError(message) {
      statusEl.textContent = message;
      statusEl.style.backgroundColor = '#ffebee';
      statusEl.style.color = '#c62828';
    }
    
    // Êõ¥Êñ∞ÂÆπÂô®ËÉåÊôØÁä∂ÊÄÅ
    function updateContainerStatus(score) {
      const container = document.querySelector('.container');
      container.classList.remove('status-unscored', 'status-pass', 'status-fail');
      
      if (score === 1) {
        container.classList.add('status-pass');
      } else if (score === 0) {
        container.classList.add('status-fail');
      } else {
        container.classList.add('status-unscored');
      }
    }
    
    // ÂÖ®Â±èÊòæÁ§∫ÂõæÁâá
    function showFullscreenImage(src) {
      // ÈöêËóèBrowserView‰ª•Á°Æ‰øùÂõæÁâáÊòæÁ§∫Âú®ÊúÄ‰∏äÂ±Ç
      ipcRenderer.invoke('hide-browser-view');
      
      // ÂàõÂª∫ÂÖ®Â±èË¶ÜÁõñÂ±Ç
      const overlay = document.createElement('div');
      overlay.className = 'fullscreen-overlay';
      
      // ÂàõÂª∫ÂÖ®Â±èÂõæÁâá
      const img = document.createElement('img');
      img.className = 'fullscreen-image';
      img.src = src;
      
      overlay.appendChild(img);
      document.body.appendChild(overlay);
      
      // ÂÖ≥Èó≠ÂáΩÊï∞
      const closeOverlay = () => {
        document.body.removeChild(overlay);
        // ÊÅ¢Â§çBrowserViewÊòæÁ§∫
        adjustBrowserViewPosition();
      };
      
      // ÁÇπÂáªÂÖ≥Èó≠
      overlay.addEventListener('click', closeOverlay);
      
      // ESCÈîÆÂÖ≥Èó≠
      const closeOnEsc = (e) => {
        if (e.key === 'Escape') {
          closeOverlay();
          document.removeEventListener('keydown', closeOnEsc);
        }
      };
      document.addEventListener('keydown', closeOnEsc);
    }
    
    // Progress Overview Functions
    function initializeProgressOverview() {
      if (!excelData || excelData.length <= 1) {
        // Ê∏ÖÁ©∫ÊòæÁ§∫
        progressGrid.innerHTML = '';
        updateProgressStats(0, 0, 0, 0);
        return;
      }
      
      const totalPages = excelData.length - 1; // ÊéíÈô§Ê†áÈ¢òË°å
      updateProgressStats(0, 0, totalPages, totalPages);
      createProgressGrid();
      updateProgressOverview();
    }
    
    function createProgressGrid() {
      if (!excelData || excelData.length <= 1) return;
      
      const totalPages = excelData.length - 1; // ÊéíÈô§Ê†áÈ¢òË°å
      progressGrid.innerHTML = '';
      
      const itemsPerRow = 15; // ÊØèË°å15‰∏™ÊñπÂùó
      const totalRows = Math.ceil(totalPages / itemsPerRow);
      
      for (let row = 0; row < totalRows; row++) {
        // Ê∑ªÂä†Ë°åÂè∑
        const rowNumber = document.createElement('div');
        rowNumber.className = 'progress-row-number';
        rowNumber.textContent = (row * itemsPerRow + 1).toString();
        rowNumber.title = `Row ${row + 1}: Pages ${row * itemsPerRow + 1}-${Math.min((row + 1) * itemsPerRow, totalPages)}`;
        progressGrid.appendChild(rowNumber);
        
        // Ê∑ªÂä†ËØ•Ë°åÁöÑËøõÂ∫¶ÊñπÂùó
        for (let col = 0; col < itemsPerRow; col++) {
          const pageIndex = row * itemsPerRow + col + 1; // ‰ªé1ÂºÄÂßãÔºåË∑≥ËøáÊ†áÈ¢òË°å
          if (pageIndex > totalPages) break;
          
          const item = document.createElement('div');
          item.className = 'progress-item';
          item.dataset.pageIndex = pageIndex;
          
          // ÁîüÊàêtooltipÂÜÖÂÆπ
          const description = excelData[pageIndex][columns.description] || excelData[pageIndex][columns.query] || 'No description';
          const truncatedDesc = description.length > 40 ? description.substring(0, 40) + '...' : description;
          item.title = `Page ${pageIndex}: ${truncatedDesc}`;
          
          // ÁÇπÂáªË∑≥ËΩ¨Âà∞ÂØπÂ∫îÈ°µÈù¢
          item.addEventListener('click', () => {
            loadPage(pageIndex);
          });
          
          progressGrid.appendChild(item);
        }
      }
    }
    
    function updateProgressOverview() {
      if (!excelData || excelData.length <= 1) return;
      
      let passCount = 0;
      let failCount = 0;
      let pendingCount = 0;
      const totalPages = excelData.length - 1; // ÊéíÈô§Ê†áÈ¢òË°å
      
      // ÁªüËÆ°ÂêÑÁä∂ÊÄÅÁöÑÈ°µÈù¢Êï∞Èáè
      for (let i = 1; i <= totalPages; i++) { // ‰ªé1ÂºÄÂßãÔºåË∑≥ËøáÊ†áÈ¢òË°å
        const result = excelData[i][columns.result];
        if (result === 1) {
          passCount++;
        } else if (result === 0) {
          failCount++;
        } else {
          pendingCount++;
        }
      }
      
      // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
      updateProgressStats(passCount, failCount, pendingCount, totalPages);
      
      // Êõ¥Êñ∞ÁΩëÊ†ºÊòæÁ§∫
      const items = progressGrid.querySelectorAll('.progress-item');
      items.forEach((item) => {
        const pageIndex = parseInt(item.dataset.pageIndex); // ‰ΩøÁî®Â≠òÂÇ®ÁöÑÈ°µÈù¢Á¥¢Âºï
        const result = excelData[pageIndex] ? excelData[pageIndex][columns.result] : null;
        
        // ÁßªÈô§ÊâÄÊúâÁä∂ÊÄÅÁ±ª
        item.classList.remove('pass', 'fail', 'pending', 'current');
        
        // Ê∑ªÂä†ÂØπÂ∫îÁöÑÁä∂ÊÄÅÁ±ª
        if (pageIndex === currentIndex) {
          item.classList.add('current');
        } else if (result === 1) {
          item.classList.add('pass');
        } else if (result === 0) {
          item.classList.add('fail');
        } else {
          item.classList.add('pending');
        }
      });
    }
    
    function updateProgressStats(passCount, failCount, pendingCount, totalCount) {
      passCountEl.textContent = passCount;
      failCountEl.textContent = failCount;
      pendingCountEl.textContent = pendingCount;
      totalCountEl.textContent = totalCount;
    }
    
    // Progress Overview toggle
    toggleProgressOverviewBtn.addEventListener('click', () => {
      progressOverviewVisible = !progressOverviewVisible;
      progressContent.style.display = progressOverviewVisible ? 'block' : 'none';
      toggleProgressOverviewBtn.textContent = progressOverviewVisible ? 'üìä' : 'üìä';
    });
    
    // Response panel toggle
    toggleResponseBtn.addEventListener('click', () => {
      responseVisible = !responseVisible;
      responseContent.style.display = responseVisible ? 'block' : 'none';
      toggleResponseBtn.textContent = responseVisible ? '‚àí' : '+';
    });
    
    // Response tab switching
    responseTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetTab = tab.dataset.tab;
        
        // Update active tab
        responseTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active content
        responseTabContents.forEach(content => {
          content.classList.remove('active');
        });
        
        const targetContent = document.getElementById(`response-${targetTab}-tab`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
        
        currentResponseTab = targetTab;
      });
    });
    
    // ResponseÊ†áÁ≠æÈ°µÂàáÊç¢‰∫ã‰ª∂
    if (responseTabs) {
      responseTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const targetTab = tab.dataset.tab;
          
          // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
          responseTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
          responseTabContents.forEach(content => content.classList.remove('active'));
          const targetContent = document.getElementById(`response-${targetTab}-tab`);
          if (targetContent) {
            targetContent.classList.add('active');
          }
          
          currentResponseTab = targetTab;
        });
      });
    }
    
    // Áº©Áï•ÂõæÈ¢ÑÂä†ËΩΩÂáΩÊï∞
    function preloadThumbnails() {
      if (!excelData || excelData.length <= 1) return;
      
      const totalPages = excelData.length - 1;
      const preloadRange = 5; // È¢ÑÂä†ËΩΩÂâçÂêé5È°µÁöÑÁº©Áï•Âõæ
      
      // ËÆ°ÁÆóÈ¢ÑÂä†ËΩΩËåÉÂõ¥
      const startIndex = Math.max(1, currentIndex - preloadRange);
      const endIndex = Math.min(totalPages, currentIndex + preloadRange);
      
      for (let i = startIndex; i <= endIndex; i++) {
        if (i === currentIndex) continue; // Ë∑≥ËøáÂΩìÂâçÈ°µÈù¢
        
        const rowData = excelData[i];
        const thumbnailUrl = rowData && rowData[columns.thumbnail_link];
        
        if (thumbnailUrl && !thumbnailCache.has(thumbnailUrl)) {
          // È¢ÑÂä†ËΩΩÁº©Áï•Âõæ
          const img = new Image();
          img.onload = () => {
            thumbnailCache.set(thumbnailUrl, img);
          };
          img.onerror = () => {
            // È¢ÑÂä†ËΩΩÂ§±Ë¥•Ôºå‰∏çÂÅöÂ§ÑÁêÜ
          };
          img.src = thumbnailUrl;
        }
      }
      
      // Ê∏ÖÁêÜËøáÊúüÁöÑÁºìÂ≠òÔºà‰øùÁïôÊúÄËøë20‰∏™Ôºâ
      if (thumbnailCache.size > 20) {
        const entries = Array.from(thumbnailCache.entries());
        const toRemove = entries.slice(0, thumbnailCache.size - 20);
        toRemove.forEach(([url]) => thumbnailCache.delete(url));
      }
    }
    
    // ResponseÂ§ÑÁêÜÂáΩÊï∞
    function parseResponseData(responseString) {
      if (!responseString || responseString.trim() === '') {
        return null;
      }
      
      try {
        return JSON.parse(responseString);
      } catch (e) {
        console.error('Error parsing response JSON:', e);
        return { error: 'Failed to parse response data', original: responseString };
      }
    }
    
    function updateResponsePanel() {
      if (!excelData || !excelData[currentIndex]) {
        clearResponsePanel();
        return;
      }
      
      const rowData = excelData[currentIndex];
      const responseString = rowData[columns.response];
      const responseData = parseResponseData(responseString);
      
      if (!responseData) {
        clearResponsePanel();
        return;
      }
      
      // Êõ¥Êñ∞ÂêÑ‰∏™Ê†áÁ≠æÈ°µÁöÑÂÜÖÂÆπ
      updateResponseContent(responseData);
      updateResponseUrls(responseData);
      updateResponseImages(responseData);
      updateResponseQuestions(responseData);
    }
    
    function clearResponsePanel() {
      if (responseContentTab) {
        responseContentTab.innerHTML = '<div class="response-no-data">No response data available</div>';
      }
      if (responseUrlsTab) {
        responseUrlsTab.innerHTML = '<div class="response-no-data">No URLs available</div>';
      }
      if (responseImagesTab) {
        responseImagesTab.innerHTML = '<div class="response-no-data">No images available</div>';
      }
      if (responseQuestionsTab) {
        responseQuestionsTab.innerHTML = '<div class="response-no-data">No related questions available</div>';
      }
    }
    
    function updateResponseContent(responseData) {
      if (!responseContentTab) return;
      
      if (responseData.error) {
        responseContentTab.innerHTML = `
          <div class="response-error">
            ${responseData.error}<br>
            <details style="margin-top: 8px;">
              <summary>Show original data</summary>
              <pre style="white-space: pre-wrap; font-size: 10px; margin-top: 4px;">${responseData.original}</pre>
            </details>
          </div>
        `;
        return;
      }
      
      let contentHtml = '';
      
      if (responseData.Content) {
        contentHtml += `<div class="response-content-section">${formatMarkdownContent(responseData.Content)}</div>`;
      }
      
      if (responseData.Title) {
        contentHtml += `<div class="response-content-section"><strong>Title:</strong><br>${escapeHtml(responseData.Title)}</div>`;
      }
      
      if (responseData.ModelResponseMessage) {
        contentHtml += `<div class="response-content-section"><strong>Model Response:</strong><br>${escapeHtml(responseData.ModelResponseMessage)}</div>`;
      }
      
      if (responseData.ErrorMessage) {
        contentHtml += `<div class="response-error"><strong>Error:</strong><br>${escapeHtml(responseData.ErrorMessage)}</div>`;
      }
      
      if (responseData.Completed !== undefined) {
        const status = responseData.Completed ? 'Completed' : 'Incomplete';
        contentHtml += `<div class="response-content-section"><strong>Status:</strong> ${status}</div>`;
      }
      
      responseContentTab.innerHTML = contentHtml || '<div class="response-no-data">No content available</div>';
    }
    
    function updateResponseUrls(responseData) {
      if (!responseUrlsTab) return;
      
      if (responseData.Urls && responseData.Urls.length > 0) {
        const urlsHtml = `
          <div class="response-urls">
            <ul>
              ${responseData.Urls.map(urlObj => {
                const url = typeof urlObj === 'string' ? urlObj : urlObj.Url;
                const title = typeof urlObj === 'object' && urlObj.Title ? urlObj.Title : url;
                return `<li><a href="${escapeHtml(url)}" target="_blank" title="${escapeHtml(url)}">${escapeHtml(title)}</a></li>`;
              }).join('')}
            </ul>
          </div>
        `;
        responseUrlsTab.innerHTML = urlsHtml;
      } else {
        responseUrlsTab.innerHTML = '<div class="response-no-data">No URLs available</div>';
      }
    }
    
    function updateResponseImages(responseData) {
      if (!responseImagesTab) return;
      
      if (responseData.Images && responseData.Images.length > 0) {
        const imagesHtml = `
          <div class="response-images">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
              ${responseData.Images.map(imageObj => {
                const imageUrl = typeof imageObj === 'string' ? imageObj : imageObj.ThumbnailUrl || imageObj.Url;
                const title = typeof imageObj === 'object' && imageObj.Title ? imageObj.Title : 'Response image';
                return `
                  <div style="background-color: #f8f9fa; border-radius: 6px; overflow: hidden; border: 1px solid #dee2e6; transition: transform 0.2s;">
                    <img src="${escapeHtml(imageUrl)}" 
                         alt="${escapeHtml(title)}" 
                         style="width: 100%; height: 120px; object-fit: cover; cursor: pointer;"
                         title="Click to view full size"
                         onclick="showFullscreenImage('${escapeHtml(imageUrl)}')"
                         onmouseover="this.parentElement.style.transform='scale(1.05)'"
                         onmouseout="this.parentElement.style.transform='scale(1)'"
                         onerror="this.parentElement.style.display='none'">
                    ${title !== 'Response image' ? `<div style="padding: 6px; font-size: 11px; color: #666; text-align: center; border-top: 1px solid #dee2e6;">${escapeHtml(title)}</div>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
        responseImagesTab.innerHTML = imagesHtml;
      } else {
        responseImagesTab.innerHTML = '<div class="response-no-data">No images available</div>';
      }
    }
    
    function updateResponseQuestions(responseData) {
      if (!responseQuestionsTab) return;
      
      if (responseData.RelatedQuestions && responseData.RelatedQuestions.length > 0) {
        const questionsHtml = `
          <div class="response-related-questions">
            <ul>
              ${responseData.RelatedQuestions.map(question => `
                <li>${escapeHtml(question)}</li>
              `).join('')}
            </ul>
          </div>
        `;
        responseQuestionsTab.innerHTML = questionsHtml;
      } else {
        responseQuestionsTab.innerHTML = '<div class="response-no-data">No related questions available</div>';
      }
    }
    
    function formatMarkdownContent(content) {
      if (typeof content !== 'string') return escapeHtml(content);
      
      // ÁÆÄÂçïÁöÑMarkdownÊ†ºÂºèÂåñ
      let formatted = escapeHtml(content);
      
      // Â§ÑÁêÜ---ÂàÜÈöîÁ¨¶ - ÂÖàÂ§ÑÁêÜÔºåÈÅøÂÖçË¢´ÂêéÁª≠ËßÑÂàôÂΩ±Âìç
      formatted = formatted.replace(/^---$/gm, '<hr style="border: none; border-top: 2px solid #e9ecef; margin: 15px 0;">');
      
      // Ê†áÈ¢ò (ÈúÄË¶ÅÂú®Êç¢Ë°åÂ§ÑÁêÜ‰πãÂâç)
      formatted = formatted.replace(/^### (.*$)/gm, '<h4 style="margin: 12px 0 8px 0; color: #495057;">$1</h4>');
      formatted = formatted.replace(/^## (.*$)/gm, '<h3 style="margin: 15px 0 10px 0; color: #495057;">$1</h3>');
      formatted = formatted.replace(/^# (.*$)/gm, '<h2 style="margin: 18px 0 12px 0; color: #495057;">$1</h2>');
      
      // Á≤ó‰Ωì
      formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      
      // Â§ÑÁêÜË°®Ê†º (ÁÆÄÂçïÂ§ÑÁêÜ)
      formatted = formatted.replace(/\|(.+)\|/g, (match, content) => {
        const cells = content.split('|').map(cell => cell.trim());
        return '<div style="display: flex; border-bottom: 1px solid #dee2e6; margin: 4px 0;">' + 
               cells.map(cell => `<div style="flex: 1; padding: 6px 8px; border-right: 1px solid #dee2e6;">${cell}</div>`).join('') + 
               '</div>';
      });
      
      // Êç¢Ë°å - ÂáèÂ∞ëÂ§ö‰ΩôÁöÑÊç¢Ë°å
      formatted = formatted.replace(/\n\n\n+/g, '\n\n'); // Â§ö‰∏™ËøûÁª≠Êç¢Ë°åÂêàÂπ∂‰∏∫‰∏§‰∏™
      formatted = formatted.replace(/\n\n/g, '<br><br>'); // ÊÆµËêΩÈó¥Ë∑ù
      formatted = formatted.replace(/\n/g, '<br>'); // ÂçïÊç¢Ë°å
      
      return formatted;
    }
    
    function escapeHtml(text) {
      if (typeof text !== 'string') return text;
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ÊòæÁ§∫Ê®°ÂºèÂàáÊç¢ÂáΩÊï∞
    function switchDisplayMode(mode) {
      if (mode === displayMode) return; // Â¶ÇÊûúÂ∑≤ÁªèÊòØÂΩìÂâçÊ®°ÂºèÔºåÁõ¥Êé•ËøîÂõû
      
      displayMode = mode;
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      webModeBtn.classList.toggle('active', mode === 'web');
      responseModeBtn.classList.toggle('active', mode === 'response');
      webonlyModeBtn.classList.toggle('active', mode === 'webonly');
      
      // ÂàáÊç¢ÊòæÁ§∫ÂÜÖÂÆπ
      if (mode === 'web') {
        // WebÊ®°ÂºèÔºöÊòæÁ§∫webviewÂíåsidebar
        webView.classList.remove('hidden', 'webonly');
        responseViewMode.classList.add('hidden');
        responseViewMode.classList.remove('webonly-hidden');
        showBrowserView();
      } else if (mode === 'response') {
        // ResponseÊ®°ÂºèÔºöÈöêËóèwebviewÔºåÊòæÁ§∫responseÔºåÊòæÁ§∫sidebar
        webView.classList.add('hidden');
        webView.classList.remove('webonly');
        responseViewMode.classList.remove('hidden', 'webonly-hidden');
        // Á°Æ‰øùBrowserViewË¢´ÈöêËóè
        hideBrowserView();
        updateResponseViewMode();
      } else if (mode === 'webonly') {
        // WebOnlyÊ®°ÂºèÔºöÂè™ÊòæÁ§∫webviewÔºåÈöêËóèresponse‰ΩÜ‰øùÁïôsidebar
        webView.classList.remove('hidden');
        webView.classList.add('webonly');
        responseViewMode.classList.add('hidden', 'webonly-hidden');
        showBrowserView();
      }
      
      updateStatus(`Switched to ${mode === 'web' ? 'Web' : mode === 'response' ? 'Response' : 'Web Only'} view mode`);
    }
    
    function updateResponseViewMode() {
      // Êõ¥Êñ∞responseÊ®°Âºè‰∏ãÁöÑËøõÂ∫¶Êù°
      if (progressFillResponse && excelData && excelData.length > 1) {
        const maxIndex = excelData.length - 1;
        const progress = maxIndex > 0 ? (currentIndex / maxIndex) * 100 : 0;
        progressFillResponse.style.width = `${progress}%`;
      }
      
      if (!excelData || !excelData[currentIndex]) {
        responseMainDisplay.innerHTML = `
          <div style="text-align: center; color: #666; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">‚ùå</div>
            <div style="font-size: 18px; margin-bottom: 10px;">No response data available</div>
            <div style="font-size: 14px; color: #999;">This page doesn't have response content</div>
          </div>
        `;
        return;
      }
      
      const rowData = excelData[currentIndex];
      console.log('Debug - Current index:', currentIndex);
      console.log('Debug - Row data:', rowData);
      console.log('Debug - Columns:', columns);
      console.log('Debug - Response column index:', columns.response);
      
      const responseString = rowData[columns.response];
      console.log('Debug - Response string:', responseString);
      console.log('Debug - Response string type:', typeof responseString);
      
      const responseData = parseResponseData(responseString);
      console.log('Debug - Parsed response data:', responseData);
      
      if (!responseData) {
        responseMainDisplay.innerHTML = `
          <div style="text-align: center; color: #666; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">üìÑ</div>
            <div style="font-size: 18px; margin-bottom: 10px;">No response data available</div>
            <div style="font-size: 14px; color: #999; margin-bottom: 20px;">This page doesn't have response content</div>
            <details style="text-align: left; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
              <summary style="cursor: pointer; font-weight: bold;">Debug info</summary>
              <pre style="white-space: pre-wrap; font-size: 12px; margin-top: 10px;">
Current index: ${currentIndex}
Response column: ${columns.response}
Response data: ${responseString}
Columns: ${JSON.stringify(columns, null, 2)}
              </pre>
            </details>
          </div>
        `;
        return;
      }
      
      if (responseData.error) {
        responseMainDisplay.innerHTML = `
          <div style="text-align: center; color: #e74c3c; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
            <div style="font-size: 18px; margin-bottom: 10px;">Error parsing response data</div>
            <div style="font-size: 14px; color: #999; margin-bottom: 20px;">${responseData.error}</div>
            <details style="text-align: left; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
              <summary style="cursor: pointer; font-weight: bold;">Show original data</summary>
              <pre style="white-space: pre-wrap; font-size: 12px; margin-top: 10px; overflow-x: auto;">${responseData.original}</pre>
            </details>
          </div>
        `;
        return;
      }
      
      // ÊûÑÂª∫responseÂÜÖÂÆπÊòæÁ§∫
      let contentHtml = `
        <div style="padding: 15px; max-width: 100%; overflow-y: auto;">
          <div style="margin-bottom: 20px;">
            <h2 style="color: #2c3e50; margin-bottom: 12px; border-bottom: 2px solid #3498db; padding-bottom: 8px;">
              üìÑ Response Content
            </h2>
      `;
      
      // Áä∂ÊÄÅ‰ø°ÊÅØ
      if (responseData.Completed !== undefined) {
        const status = responseData.Completed ? 'Completed ‚úÖ' : 'Incomplete ‚è≥';
        const statusColor = responseData.Completed ? '#27ae60' : '#f39c12';
        contentHtml += `
          <div style="background-color: ${statusColor}20; border-left: 4px solid ${statusColor}; padding: 8px; margin-bottom: 10px; border-radius: 4px;">
            <strong>Status:</strong> <span style="color: ${statusColor}; font-weight: bold;">${status}</span>
          </div>
        `;
      }
      
      // Ê†áÈ¢ò
      if (responseData.Title) {
        contentHtml += `
          <div style="background-color: #f8f9fa; padding: 12px; margin-bottom: 10px; border-radius: 4px; border-left: 4px solid #007bff;">
            <h3 style="margin: 0; color: #007bff;">üìã Title</h3>
            <p style="margin: 8px 0 0 0; font-size: 16px; line-height: 1.6;">${escapeHtml(responseData.Title)}</p>
          </div>
        `;
      }
      
      // ‰∏ªË¶ÅÂÜÖÂÆπ
      if (responseData.Content) {
        contentHtml += `
          <div style="background-color: #ffffff; padding: 15px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #e9ecef; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; color: #495057;">üìù Content</h3>
            <div style="line-height: 1.6; font-size: 14px;">${formatMarkdownContent(responseData.Content)}</div>
          </div>
        `;
      }
      
      // URLs
      if (responseData.Urls && responseData.Urls.length > 0) {
        contentHtml += `
          <div style="background-color: #ffffff; padding: 15px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #e9ecef; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; color: #495057;">üîó Related URLs (${responseData.Urls.length})</h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
              ${responseData.Urls.map(urlObj => {
                const url = typeof urlObj === 'string' ? urlObj : urlObj.Url;
                const title = typeof urlObj === 'object' && urlObj.Title ? urlObj.Title : url;
                return `
                  <li style="margin-bottom: 6px; padding: 8px; background-color: #f8f9fa; border-radius: 4px; border-left: 3px solid #007bff;">
                    <a href="${escapeHtml(url)}" target="_blank" style="color: #007bff; text-decoration: none; font-weight: 500; display: block; word-break: break-all;" 
                       onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'"
                       title="${escapeHtml(url)}">${escapeHtml(title)}</a>
                  </li>
                `;
              }).join('')}
            </ul>
          </div>
        `;
      }
      
      // ÂõæÁâá
      if (responseData.Images && responseData.Images.length > 0) {
        contentHtml += `
          <div style="background-color: #ffffff; padding: 15px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #e9ecef; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; color: #495057;">üñºÔ∏è Images (${responseData.Images.length})</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
              ${responseData.Images.map(imageObj => {
                const imageUrl = typeof imageObj === 'string' ? imageObj : imageObj.ThumbnailUrl || imageObj.Url;
                const title = typeof imageObj === 'object' && imageObj.Title ? imageObj.Title : 'Response image';
                return `
                  <div style="background-color: #f8f9fa; border-radius: 6px; overflow: hidden; border: 1px solid #dee2e6; transition: transform 0.2s;">
                    <img src="${escapeHtml(imageUrl)}" 
                         alt="${escapeHtml(title)}" 
                         style="width: 100%; height: 140px; object-fit: cover; cursor: pointer;"
                         title="Click to view full size"
                         onclick="showFullscreenImage('${escapeHtml(imageUrl)}')"
                         onmouseover="this.parentElement.style.transform='scale(1.05)'"
                         onmouseout="this.parentElement.style.transform='scale(1)'"
                         onerror="this.parentElement.style.display='none'">
                    ${title !== 'Response image' ? `<div style="padding: 8px; font-size: 12px; color: #666; text-align: center; border-top: 1px solid #dee2e6;">${escapeHtml(title)}</div>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }
      
      // Áõ∏ÂÖ≥ÈóÆÈ¢ò
      if (responseData.RelatedQuestions && responseData.RelatedQuestions.length > 0) {
        contentHtml += `
          <div style="background-color: #ffffff; padding: 15px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #e9ecef; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; color: #495057;">‚ùì Related Questions (${responseData.RelatedQuestions.length})</h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
              ${responseData.RelatedQuestions.map(question => `
                <li style="margin-bottom: 6px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; border-left: 3px solid #28a745;">
                  <span style="color: #495057; line-height: 1.6;">${escapeHtml(question)}</span>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }
      
      // ÈîôËØØ‰ø°ÊÅØ
      if (responseData.ErrorMessage) {
        contentHtml += `
          <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 12px; margin-bottom: 10px; border-radius: 4px; border-left: 4px solid #dc3545;">
            <h3 style="margin: 0 0 8px 0; color: #721c24;">‚ö†Ô∏è Error Message</h3>
            <p style="margin: 0; color: #721c24;">${escapeHtml(responseData.ErrorMessage)}</p>
          </div>
        `;
      }
      
      // Ê®°ÂûãÂìçÂ∫î
      if (responseData.ModelResponseMessage) {
        contentHtml += `
          <div style="background-color: #e2e3e5; border: 1px solid #d6d8db; padding: 12px; margin-bottom: 10px; border-radius: 4px; border-left: 4px solid #6c757d;">
            <h3 style="margin: 0 0 8px 0; color: #495057;">ü§ñ Model Response</h3>
            <p style="margin: 0; color: #495057; font-family: monospace; font-size: 13px;">${escapeHtml(responseData.ModelResponseMessage)}</p>
          </div>
        `;
      }
      
      contentHtml += `
          </div>
        </div>
      `;
      
      responseMainDisplay.innerHTML = contentHtml;
    }
    
    function showBrowserView() {
      ipcRenderer.invoke('show-browser-view').catch(error => {
        console.error('Error showing browser view:', error);
      });
    }
    
    function hideBrowserView() {
      ipcRenderer.invoke('hide-browser-view').catch(error => {
        console.error('Error hiding browser view:', error);
      });
    }
  </script>
</body>
</html> 